# é€šç”¨ä¿¡æ¯æŠ½å– UIE(Universal Information Extraction)

 **ç›®å½•**

- [1. æ¨¡å‹ç®€ä»‹](#æ¨¡å‹ç®€ä»‹)
- [2. åº”ç”¨ç¤ºä¾‹](#åº”ç”¨ç¤ºä¾‹)
- [3. å¼€ç®±å³ç”¨](#å¼€ç®±å³ç”¨)
  - [3.1 å®ä½“æŠ½å–](#å®ä½“æŠ½å–)
  - [3.2 å…³ç³»æŠ½å–](#å…³ç³»æŠ½å–)
  - [3.3 äº‹ä»¶æŠ½å–](#äº‹ä»¶æŠ½å–)
  - [3.4 è¯„è®ºè§‚ç‚¹æŠ½å–](#è¯„è®ºè§‚ç‚¹æŠ½å–)
  - [3.5 æƒ…æ„Ÿåˆ†ç±»](#æƒ…æ„Ÿåˆ†ç±»)
  - [3.6 è·¨ä»»åŠ¡æŠ½å–](#è·¨ä»»åŠ¡æŠ½å–)
  - [3.7 æ¨¡å‹é€‰æ‹©](#æ¨¡å‹é€‰æ‹©)
  - [3.8 æ›´å¤šé…ç½®](#æ›´å¤šé…ç½®)
- [4. è®­ç»ƒå®šåˆ¶](#è®­ç»ƒå®šåˆ¶)
  - [4.1 ä»£ç ç»“æ„](#ä»£ç ç»“æ„)
  - [4.2 æ•°æ®æ ‡æ³¨](#æ•°æ®æ ‡æ³¨)
  - [4.3 æ¨¡å‹å¾®è°ƒ](#æ¨¡å‹å¾®è°ƒ)
  - [4.4 æ¨¡å‹è¯„ä¼°](#æ¨¡å‹è¯„ä¼°)
  - [4.5 å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹](#å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹)
  - [4.6 æ¨¡å‹å¿«é€ŸæœåŠ¡åŒ–éƒ¨ç½²](#æ¨¡å‹å¿«é€ŸæœåŠ¡åŒ–éƒ¨ç½²)
  - [4.7 å®éªŒæŒ‡æ ‡](#å®éªŒæŒ‡æ ‡)
  - [4.8 æ¨¡å‹éƒ¨ç½²](#æ¨¡å‹éƒ¨ç½²)
- [5. CCKSæ¯”èµ›](#CCKSæ¯”èµ›)

<a name="æ¨¡å‹ç®€ä»‹"></a>

## 1. æ¨¡å‹ç®€ä»‹

[UIE(Universal Information Extraction)](https://arxiv.org/pdf/2203.12277.pdf)ï¼šYaojie Luç­‰äººåœ¨ACL-2022ä¸­æå‡ºäº†é€šç”¨ä¿¡æ¯æŠ½å–ç»Ÿä¸€æ¡†æ¶UIEã€‚è¯¥æ¡†æ¶å®ç°äº†å®ä½“æŠ½å–ã€å…³ç³»æŠ½å–ã€äº‹ä»¶æŠ½å–ã€æƒ…æ„Ÿåˆ†æç­‰ä»»åŠ¡çš„ç»Ÿä¸€å»ºæ¨¡ï¼Œå¹¶ä½¿å¾—ä¸åŒä»»åŠ¡é—´å…·å¤‡è‰¯å¥½çš„è¿ç§»å’Œæ³›åŒ–èƒ½åŠ›ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶ä½¿ç”¨UIEçš„å¼ºå¤§èƒ½åŠ›ï¼ŒPaddleNLPå€Ÿé‰´è¯¥è®ºæ–‡çš„æ–¹æ³•ï¼ŒåŸºäºERNIE 3.0çŸ¥è¯†å¢å¼ºé¢„è®­ç»ƒæ¨¡å‹ï¼Œè®­ç»ƒå¹¶å¼€æºäº†é¦–ä¸ªä¸­æ–‡é€šç”¨ä¿¡æ¯æŠ½å–æ¨¡å‹UIEã€‚è¯¥æ¨¡å‹å¯ä»¥æ”¯æŒä¸é™å®šè¡Œä¸šé¢†åŸŸå’ŒæŠ½å–ç›®æ ‡çš„å…³é”®ä¿¡æ¯æŠ½å–ï¼Œå®ç°é›¶æ ·æœ¬å¿«é€Ÿå†·å¯åŠ¨ï¼Œå¹¶å…·å¤‡ä¼˜ç§€çš„å°æ ·æœ¬å¾®è°ƒèƒ½åŠ›ï¼Œå¿«é€Ÿé€‚é…ç‰¹å®šçš„æŠ½å–ç›®æ ‡ã€‚

<div align="center">
    <img src=https://user-images.githubusercontent.com/40840292/167236006-66ed845d-21b8-4647-908b-e1c6e7613eb1.png height=400 hspace='10'/>
</div>

#### News ğŸ“¢: UIE-X ğŸ§¾

**å…¨æ–°å‡çº§UIE-Xï¼Œé™¤å·²æœ‰çº¯æ–‡æœ¬æŠ½å–çš„å…¨éƒ¨åŠŸèƒ½å¤–ï¼Œæ–°å¢æ–‡æ¡£æŠ½å–èƒ½åŠ›**ï¼Œæ¬¢è¿ä½“éªŒ ğŸ‘‰ [ä¿¡æ¯æŠ½å–åº”ç”¨](https://github.com/PaddlePaddle/PaddleNLP/tree/develop/applications/information_extraction/#readme)

#### UIEçš„ä¼˜åŠ¿

- **ä½¿ç”¨ç®€å•**ï¼šç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªç„¶è¯­è¨€è‡ªå®šä¹‰æŠ½å–ç›®æ ‡ï¼Œæ— éœ€è®­ç»ƒå³å¯ç»Ÿä¸€æŠ½å–è¾“å…¥æ–‡æœ¬ä¸­çš„å¯¹åº”ä¿¡æ¯ã€‚**å®ç°å¼€ç®±å³ç”¨ï¼Œå¹¶æ»¡è¶³å„ç±»ä¿¡æ¯æŠ½å–éœ€æ±‚**ã€‚

- **é™æœ¬å¢æ•ˆ**ï¼šä»¥å¾€çš„ä¿¡æ¯æŠ½å–æŠ€æœ¯éœ€è¦å¤§é‡æ ‡æ³¨æ•°æ®æ‰èƒ½ä¿è¯ä¿¡æ¯æŠ½å–çš„æ•ˆæœï¼Œä¸ºäº†æé«˜å¼€å‘è¿‡ç¨‹ä¸­çš„å¼€å‘æ•ˆç‡ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡å¤å·¥ä½œæ—¶é—´ï¼Œå¼€æ”¾åŸŸä¿¡æ¯æŠ½å–å¯ä»¥å®ç°é›¶æ ·æœ¬ï¼ˆzero-shotï¼‰æˆ–è€…å°‘æ ·æœ¬ï¼ˆfew-shotï¼‰æŠ½å–ï¼Œ**å¤§å¹…åº¦é™ä½æ ‡æ³¨æ•°æ®ä¾èµ–ï¼Œåœ¨é™ä½æˆæœ¬çš„åŒæ—¶ï¼Œè¿˜æå‡äº†æ•ˆæœ**ã€‚

- **æ•ˆæœé¢†å…ˆ**ï¼šå¼€æ”¾åŸŸä¿¡æ¯æŠ½å–åœ¨å¤šç§åœºæ™¯ï¼Œå¤šç§ä»»åŠ¡ä¸Šï¼Œå‡æœ‰ä¸ä¿—çš„è¡¨ç°ã€‚

<a name="åº”ç”¨ç¤ºä¾‹"></a>

## 2. åº”ç”¨ç¤ºä¾‹

UIEä¸é™å®šè¡Œä¸šé¢†åŸŸå’ŒæŠ½å–ç›®æ ‡ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›é›¶æ ·æœ¬è¡Œä¸šç¤ºä¾‹ï¼š

- åŒ»ç–—åœºæ™¯-ä¸“ç—…ç»“æ„åŒ–

![image](https://user-images.githubusercontent.com/40840292/169017581-93c8ee44-856d-4d17-970c-b6138d10f8bc.png)

- æ³•å¾‹åœºæ™¯-åˆ¤å†³ä¹¦æŠ½å–

![image](https://user-images.githubusercontent.com/40840292/169017863-442c50f1-bfd4-47d0-8d95-8b1d53cfba3c.png)

- é‡‘èåœºæ™¯-æ”¶å…¥è¯æ˜ã€æ‹›è‚¡ä¹¦æŠ½å–

![image](https://user-images.githubusercontent.com/40840292/169017982-e521ddf6-d233-41f3-974e-6f40f8f2edbc.png)

- å…¬å®‰åœºæ™¯-äº‹æ•…æŠ¥å‘ŠæŠ½å–

![image](https://user-images.githubusercontent.com/40840292/169018340-31efc1bf-f54d-43f7-b62a-8f7ce9bf0536.png)

- æ—…æ¸¸åœºæ™¯-å®£ä¼ å†Œã€æ‰‹å†ŒæŠ½å–

![image](https://user-images.githubusercontent.com/40840292/169018113-c937eb0b-9fd7-4ecc-8615-bcdde2dac81d.png)

<a name="å¼€ç®±å³ç”¨"></a>

## 3. å¼€ç®±å³ç”¨

```paddlenlp.Taskflow```æä¾›é€šç”¨ä¿¡æ¯æŠ½å–ã€è¯„ä»·è§‚ç‚¹æŠ½å–ç­‰èƒ½åŠ›ï¼Œå¯æŠ½å–å¤šç§ç±»å‹çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå‘½åå®ä½“è¯†åˆ«ï¼ˆå¦‚äººåã€åœ°åã€æœºæ„åç­‰ï¼‰ã€å…³ç³»ï¼ˆå¦‚ç”µå½±çš„å¯¼æ¼”ã€æ­Œæ›²çš„å‘è¡Œæ—¶é—´ç­‰ï¼‰ã€äº‹ä»¶ï¼ˆå¦‚æŸè·¯å£å‘ç”Ÿè½¦ç¥¸ã€æŸåœ°å‘ç”Ÿåœ°éœ‡ç­‰ï¼‰ã€ä»¥åŠè¯„ä»·ç»´åº¦ã€è§‚ç‚¹è¯ã€æƒ…æ„Ÿå€¾å‘ç­‰ä¿¡æ¯ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªç„¶è¯­è¨€è‡ªå®šä¹‰æŠ½å–ç›®æ ‡ï¼Œæ— éœ€è®­ç»ƒå³å¯ç»Ÿä¸€æŠ½å–è¾“å…¥æ–‡æœ¬ä¸­çš„å¯¹åº”ä¿¡æ¯ã€‚**å®ç°å¼€ç®±å³ç”¨ï¼Œå¹¶æ»¡è¶³å„ç±»ä¿¡æ¯æŠ½å–éœ€æ±‚**

<a name="å®ä½“æŠ½å–"></a>

#### 3.1 å®ä½“æŠ½å–

  å‘½åå®ä½“è¯†åˆ«ï¼ˆNamed Entity Recognitionï¼Œç®€ç§°NERï¼‰ï¼Œæ˜¯æŒ‡è¯†åˆ«æ–‡æœ¬ä¸­å…·æœ‰ç‰¹å®šæ„ä¹‰çš„å®ä½“ã€‚åœ¨å¼€æ”¾åŸŸä¿¡æ¯æŠ½å–ä¸­ï¼ŒæŠ½å–çš„ç±»åˆ«æ²¡æœ‰é™åˆ¶ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±å®šä¹‰ã€‚

  - ä¾‹å¦‚æŠ½å–çš„ç›®æ ‡å®ä½“ç±»å‹æ˜¯"æ—¶é—´"ã€"é€‰æ‰‹"å’Œ"èµ›äº‹åç§°", schemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    ['æ—¶é—´', 'é€‰æ‰‹', 'èµ›äº‹åç§°']
    ```

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> from pprint import pprint
    >>> from paddlenlp import Taskflow

    >>> schema = ['æ—¶é—´', 'é€‰æ‰‹', 'èµ›äº‹åç§°'] # Define the schema for entity extraction
    >>> ie = Taskflow('information_extraction', schema=schema)
    >>> pprint(ie("2æœˆ8æ—¥ä¸ŠåˆåŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›ä¸­ä¸­å›½é€‰æ‰‹è°·çˆ±å‡Œä»¥188.25åˆ†è·å¾—é‡‘ç‰Œï¼")) # Better print results using pprint
    [{'æ—¶é—´': [{'end': 6,
              'probability': 0.9857378532924486,
              'start': 0,
              'text': '2æœˆ8æ—¥ä¸Šåˆ'}],
      'èµ›äº‹åç§°': [{'end': 23,
                'probability': 0.8503089953268272,
                'start': 6,
                'text': 'åŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›'}],
      'é€‰æ‰‹': [{'end': 31,
              'probability': 0.8981548639781138,
              'start': 28,
              'text': 'è°·çˆ±å‡Œ'}]}]
    ```

  - ä¾‹å¦‚æŠ½å–çš„ç›®æ ‡å®ä½“ç±»å‹æ˜¯"è‚¿ç˜¤çš„å¤§å°"ã€"è‚¿ç˜¤çš„ä¸ªæ•°"ã€"è‚ç™Œçº§åˆ«"å’Œ"è„‰ç®¡å†…ç™Œæ “åˆ†çº§", schemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    ['è‚¿ç˜¤çš„å¤§å°', 'è‚¿ç˜¤çš„ä¸ªæ•°', 'è‚ç™Œçº§åˆ«', 'è„‰ç®¡å†…ç™Œæ “åˆ†çº§']
    ```

    åœ¨ä¸Šä¾‹ä¸­æˆ‘ä»¬å·²ç»å®ä¾‹åŒ–äº†ä¸€ä¸ª`Taskflow`å¯¹è±¡ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡`set_schema`æ–¹æ³•é‡ç½®æŠ½å–ç›®æ ‡ã€‚

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = ['è‚¿ç˜¤çš„å¤§å°', 'è‚¿ç˜¤çš„ä¸ªæ•°', 'è‚ç™Œçº§åˆ«', 'è„‰ç®¡å†…ç™Œæ “åˆ†çº§']
    >>> ie.set_schema(schema)
    >>> pprint(ie("ï¼ˆå³è‚è‚¿ç˜¤ï¼‰è‚ç»†èƒæ€§è‚ç™Œï¼ˆII-IIIçº§ï¼Œæ¢ç´¢å‹å’Œå‡è…ºç®¡å‹ï¼‰ï¼Œè‚¿ç˜¤åŒ…è†œä¸å®Œæ•´ï¼Œç´§é‚»è‚è¢«è†œï¼Œä¾µåŠå‘¨å›´è‚ç»„ç»‡ï¼Œæœªè§è„‰ç®¡å†…ç™Œæ “ï¼ˆMVIåˆ†çº§ï¼šM0çº§ï¼‰åŠå«æ˜Ÿå­ç¶å½¢æˆã€‚ï¼ˆè‚¿ç‰©1ä¸ªï¼Œå¤§å°4.2Ã—4.0Ã—2.8cmï¼‰ã€‚"))
    [{'è‚ç™Œçº§åˆ«': [{'end': 20,
                'probability': 0.9243267447402701,
                'start': 13,
                'text': 'II-IIIçº§'}],
      'è‚¿ç˜¤çš„ä¸ªæ•°': [{'end': 84,
                'probability': 0.7538413804059623,
                'start': 82,
                'text': '1ä¸ª'}],
      'è‚¿ç˜¤çš„å¤§å°': [{'end': 100,
                'probability': 0.8341128043459491,
                'start': 87,
                'text': '4.2Ã—4.0Ã—2.8cm'}],
      'è„‰ç®¡å†…ç™Œæ “åˆ†çº§': [{'end': 70,
                  'probability': 0.9083292325934664,
                  'start': 67,
                  'text': 'M0çº§'}]}]
    ```

  - ä¾‹å¦‚æŠ½å–çš„ç›®æ ‡å®ä½“ç±»å‹æ˜¯"person"å’Œ"organization"ï¼Œschemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    ['person', 'organization']
    ```

    è‹±æ–‡æ¨¡å‹è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> from pprint import pprint
    >>> from paddlenlp import Taskflow
    >>> schema = ['Person', 'Organization']
    >>> ie_en = Taskflow('information_extraction', schema=schema, model='uie-base-en')
    >>> pprint(ie_en('In 1997, Steve was excited to become the CEO of Apple.'))
    [{'Organization': [{'end': 53,
                        'probability': 0.9985840259877357,
                        'start': 48,
                        'text': 'Apple'}],
      'Person': [{'end': 14,
                  'probability': 0.999631971804547,
                  'start': 9,
                  'text': 'Steve'}]}]
    ```

<a name="å…³ç³»æŠ½å–"></a>

#### 3.2 å…³ç³»æŠ½å–

  å…³ç³»æŠ½å–ï¼ˆRelation Extractionï¼Œç®€ç§°REï¼‰ï¼Œæ˜¯æŒ‡ä»æ–‡æœ¬ä¸­è¯†åˆ«å®ä½“å¹¶æŠ½å–å®ä½“ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ï¼Œè¿›è€Œè·å–ä¸‰å…ƒç»„ä¿¡æ¯ï¼Œå³<ä¸»ä½“ï¼Œè°“è¯­ï¼Œå®¢ä½“>ã€‚

  - ä¾‹å¦‚ä»¥"ç«èµ›åç§°"ä½œä¸ºæŠ½å–ä¸»ä½“ï¼ŒæŠ½å–å…³ç³»ç±»å‹ä¸º"ä¸»åŠæ–¹"ã€"æ‰¿åŠæ–¹"å’Œ"å·²ä¸¾åŠæ¬¡æ•°", schemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    {
      'ç«èµ›åç§°': [
        'ä¸»åŠæ–¹',
        'æ‰¿åŠæ–¹',
        'å·²ä¸¾åŠæ¬¡æ•°'
      ]
    }
    ```

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = {'ç«èµ›åç§°': ['ä¸»åŠæ–¹', 'æ‰¿åŠæ–¹', 'å·²ä¸¾åŠæ¬¡æ•°']} # Define the schema for relation extraction
    >>> ie.set_schema(schema) # Reset schema
    >>> pprint(ie('2022è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›ç”±ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼šå’Œä¸­å›½è®¡ç®—æœºå­¦ä¼šè”åˆä¸»åŠï¼Œç™¾åº¦å…¬å¸ã€ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼šè¯„æµ‹å·¥ä½œå§”å‘˜ä¼šå’Œä¸­å›½è®¡ç®—æœºå­¦ä¼šè‡ªç„¶è¯­è¨€å¤„ç†ä¸“å§”ä¼šæ‰¿åŠï¼Œå·²è¿ç»­ä¸¾åŠ4å±Šï¼Œæˆä¸ºå…¨çƒæœ€çƒ­é—¨çš„ä¸­æ–‡NLPèµ›äº‹ä¹‹ä¸€ã€‚'))
    [{'ç«èµ›åç§°': [{'end': 13,
                'probability': 0.7825402622754041,
                'relations': {'ä¸»åŠæ–¹': [{'end': 22,
                                      'probability': 0.8421710521379353,
                                      'start': 14,
                                      'text': 'ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼š'},
                                      {'end': 30,
                                      'probability': 0.7580801847701935,
                                      'start': 23,
                                      'text': 'ä¸­å›½è®¡ç®—æœºå­¦ä¼š'}],
                              'å·²ä¸¾åŠæ¬¡æ•°': [{'end': 82,
                                        'probability': 0.4671295049136148,
                                        'start': 80,
                                        'text': '4å±Š'}],
                              'æ‰¿åŠæ–¹': [{'end': 39,
                                      'probability': 0.8292706618236352,
                                      'start': 35,
                                      'text': 'ç™¾åº¦å…¬å¸'},
                                      {'end': 72,
                                      'probability': 0.6193477885474685,
                                      'start': 56,
                                      'text': 'ä¸­å›½è®¡ç®—æœºå­¦ä¼šè‡ªç„¶è¯­è¨€å¤„ç†ä¸“å§”ä¼š'},
                                      {'end': 55,
                                      'probability': 0.7000497331473241,
                                      'start': 40,
                                      'text': 'ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼šè¯„æµ‹å·¥ä½œå§”å‘˜ä¼š'}]},
                'start': 0,
                'text': '2022è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›'}]}]
    ```

  - ä¾‹å¦‚ä»¥"person"ä½œä¸ºæŠ½å–ä¸»ä½“ï¼ŒæŠ½å–å…³ç³»ç±»å‹ä¸º"Company"å’Œ"Position", schemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    {
      'Person': [
        'Company',
        'Position'
      ]
    }
    ```

    è‹±æ–‡æ¨¡å‹è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = [{'Person': ['Company', 'Position']}]
    >>> ie_en.set_schema(schema)
    >>> pprint(ie_en('In 1997, Steve was excited to become the CEO of Apple.'))
    [{'Person': [{'end': 14,
                  'probability': 0.999631971804547,
                  'relations': {'Company': [{'end': 53,
                                            'probability': 0.9960158209451642,
                                            'start': 48,
                                            'text': 'Apple'}],
                                'Position': [{'end': 44,
                                              'probability': 0.8871063806420736,
                                              'start': 41,
                                              'text': 'CEO'}]},
                  'start': 9,
                  'text': 'Steve'}]}]
    ```

<a name="äº‹ä»¶æŠ½å–"></a>

#### 3.3 äº‹ä»¶æŠ½å–

  äº‹ä»¶æŠ½å– (Event Extraction, ç®€ç§°EE)ï¼Œæ˜¯æŒ‡ä»è‡ªç„¶è¯­è¨€æ–‡æœ¬ä¸­æŠ½å–é¢„å®šä¹‰çš„äº‹ä»¶è§¦å‘è¯(Trigger)å’Œäº‹ä»¶è®ºå…ƒ(Argument)ï¼Œç»„åˆä¸ºç›¸åº”çš„äº‹ä»¶ç»“æ„åŒ–ä¿¡æ¯ã€‚

  - ä¾‹å¦‚æŠ½å–çš„ç›®æ ‡æ˜¯"åœ°éœ‡"äº‹ä»¶çš„"åœ°éœ‡å¼ºåº¦"ã€"æ—¶é—´"ã€"éœ‡ä¸­ä½ç½®"å’Œ"éœ‡æºæ·±åº¦"è¿™äº›ä¿¡æ¯ï¼Œschemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    {
      'åœ°éœ‡è§¦å‘è¯': [
        'åœ°éœ‡å¼ºåº¦',
        'æ—¶é—´',
        'éœ‡ä¸­ä½ç½®',
        'éœ‡æºæ·±åº¦'
      ]
    }
    ```

    è§¦å‘è¯çš„æ ¼å¼ç»Ÿä¸€ä¸º`è§¦å‘è¯`æˆ–``XXè§¦å‘è¯`ï¼Œ`XX`è¡¨ç¤ºå…·ä½“äº‹ä»¶ç±»å‹ï¼Œä¸Šä¾‹ä¸­çš„äº‹ä»¶ç±»å‹æ˜¯`åœ°éœ‡`ï¼Œåˆ™å¯¹åº”è§¦å‘è¯ä¸º`åœ°éœ‡è§¦å‘è¯`ã€‚

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = {'åœ°éœ‡è§¦å‘è¯': ['åœ°éœ‡å¼ºåº¦', 'æ—¶é—´', 'éœ‡ä¸­ä½ç½®', 'éœ‡æºæ·±åº¦']} # Define the schema for event extraction
    >>> ie.set_schema(schema) # Reset schema
    >>> ie('ä¸­å›½åœ°éœ‡å°ç½‘æ­£å¼æµ‹å®šï¼š5æœˆ16æ—¥06æ—¶08åˆ†åœ¨äº‘å—ä¸´æ²§å¸‚å‡¤åº†å¿(åŒ—çº¬24.34åº¦ï¼Œä¸œç»99.98åº¦)å‘ç”Ÿ3.5çº§åœ°éœ‡ï¼Œéœ‡æºæ·±åº¦10åƒç±³ã€‚')
    [{'åœ°éœ‡è§¦å‘è¯': [{'text': 'åœ°éœ‡', 'start': 56, 'end': 58, 'probability': 0.9987181623528585, 'relations': {'åœ°éœ‡å¼ºåº¦': [{'text': '3.5çº§', 'start': 52, 'end': 56, 'probability': 0.9962985320905915}], 'æ—¶é—´': [{'text': '5æœˆ16æ—¥06æ—¶08åˆ†', 'start': 11, 'end': 22, 'probability': 0.9882578028575182}], 'éœ‡ä¸­ä½ç½®': [{'text': 'äº‘å—ä¸´æ²§å¸‚å‡¤åº†å¿(åŒ—çº¬24.34åº¦ï¼Œä¸œç»99.98åº¦)', 'start': 23, 'end': 50, 'probability': 0.8551415716584501}], 'éœ‡æºæ·±åº¦': [{'text': '10åƒç±³', 'start': 63, 'end': 67, 'probability': 0.999158304648045}]}}]}]
    ```

  - è‹±æ–‡æ¨¡å‹**æš‚ä¸æ”¯æŒäº‹ä»¶æŠ½å–**

<a name="è¯„è®ºè§‚ç‚¹æŠ½å–"></a>

#### 3.4 è¯„è®ºè§‚ç‚¹æŠ½å–

  è¯„è®ºè§‚ç‚¹æŠ½å–ï¼Œæ˜¯æŒ‡æŠ½å–æ–‡æœ¬ä¸­åŒ…å«çš„è¯„ä»·ç»´åº¦ã€è§‚ç‚¹è¯ã€‚

  - ä¾‹å¦‚æŠ½å–çš„ç›®æ ‡æ˜¯æ–‡æœ¬ä¸­åŒ…å«çš„è¯„ä»·ç»´åº¦åŠå…¶å¯¹åº”çš„è§‚ç‚¹è¯å’Œæƒ…æ„Ÿå€¾å‘ï¼Œschemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    {
      'è¯„ä»·ç»´åº¦': [
        'è§‚ç‚¹è¯',
        'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]'
      ]
    }
    ```

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = {'è¯„ä»·ç»´åº¦': ['è§‚ç‚¹è¯', 'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]']} # Define the schema for opinion extraction
    >>> ie.set_schema(schema) # Reset schema
    >>> pprint(ie("åº—é¢å¹²å‡€ï¼Œå¾ˆæ¸…é™ï¼ŒæœåŠ¡å‘˜æœåŠ¡çƒ­æƒ…ï¼Œæ€§ä»·æ¯”å¾ˆé«˜ï¼Œå‘ç°æ”¶é“¶å°æœ‰æ’é˜Ÿ")) # Better print results using pprint
    [{'è¯„ä»·ç»´åº¦': [{'end': 20,
                'probability': 0.9817040258681473,
                'relations': {'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]': [{'probability': 0.9966142505350533,
                                              'text': 'æ­£å‘'}],
                              'è§‚ç‚¹è¯': [{'end': 22,
                                      'probability': 0.957396472711558,
                                      'start': 21,
                                      'text': 'é«˜'}]},
                'start': 17,
                'text': 'æ€§ä»·æ¯”'},
              {'end': 2,
                'probability': 0.9696849569741168,
                'relations': {'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]': [{'probability': 0.9982153274927796,
                                              'text': 'æ­£å‘'}],
                              'è§‚ç‚¹è¯': [{'end': 4,
                                      'probability': 0.9945318044652538,
                                      'start': 2,
                                      'text': 'å¹²å‡€'}]},
                'start': 0,
                'text': 'åº—é¢'}]}]
    ```

  - è‹±æ–‡æ¨¡å‹schemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    {
      'Aspect': [
        'Opinion',
        'Sentiment classification [negative, positive]'
      ]
    }
    ```

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = [{'Aspect': ['Opinion', 'Sentiment classification [negative, positive]']}]
    >>> ie_en.set_schema(schema)
    >>> pprint(ie_en("The teacher is very nice."))
    [{'Aspect': [{'end': 11,
                  'probability': 0.4301476415932193,
                  'relations': {'Opinion': [{'end': 24,
                                            'probability': 0.9072940447883724,
                                            'start': 15,
                                            'text': 'very nice'}],
                                'Sentiment classification [negative, positive]': [{'probability': 0.9998571920670685,
                                                                                  'text': 'positive'}]},
                  'start': 4,
                  'text': 'teacher'}]}]
    ```

<a name="æƒ…æ„Ÿåˆ†ç±»"></a>

#### 3.5 æƒ…æ„Ÿåˆ†ç±»

  - å¥å­çº§æƒ…æ„Ÿå€¾å‘åˆ†ç±»ï¼Œå³åˆ¤æ–­å¥å­çš„æƒ…æ„Ÿå€¾å‘æ˜¯â€œæ­£å‘â€è¿˜æ˜¯â€œè´Ÿå‘â€ï¼Œschemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]'
    ```

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = 'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]' # Define the schema for sentence-level sentiment classification
    >>> ie.set_schema(schema) # Reset schema
    >>> ie('è¿™ä¸ªäº§å“ç”¨èµ·æ¥çœŸçš„å¾ˆæµç•…ï¼Œæˆ‘éå¸¸å–œæ¬¢')
    [{'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]': [{'text': 'æ­£å‘', 'probability': 0.9988661643929895}]}]
    ```

    è‹±æ–‡æ¨¡å‹schemaæ„é€ å¦‚ä¸‹ï¼š

    ```text
    'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]'
    ```

    è‹±æ–‡æ¨¡å‹è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = 'Sentiment classification [negative, positive]'
    >>> ie_en.set_schema(schema)
    >>> ie_en('I am sorry but this is the worst film I have ever seen in my life.')
    [{'Sentiment classification [negative, positive]': [{'text': 'negative', 'probability': 0.9998415771287057}]}]
    ```

<a name="è·¨ä»»åŠ¡æŠ½å–"></a>

#### 3.6 è·¨ä»»åŠ¡æŠ½å–

  - ä¾‹å¦‚åœ¨æ³•å¾‹åœºæ™¯åŒæ—¶å¯¹æ–‡æœ¬è¿›è¡Œå®ä½“æŠ½å–å’Œå…³ç³»æŠ½å–ï¼Œschemaå¯æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ„é€ ï¼š

    ```text
    [
      "æ³•é™¢",
      {
          "åŸå‘Š": "å§”æ‰˜ä»£ç†äºº"
      },
      {
          "è¢«å‘Š": "å§”æ‰˜ä»£ç†äºº"
      }
    ]
    ```

    è°ƒç”¨ç¤ºä¾‹ï¼š

    ```python
    >>> schema = ['æ³•é™¢', {'åŸå‘Š': 'å§”æ‰˜ä»£ç†äºº'}, {'è¢«å‘Š': 'å§”æ‰˜ä»£ç†äºº'}]
    >>> ie.set_schema(schema)
    >>> pprint(ie("åŒ—äº¬å¸‚æµ·æ·€åŒºäººæ°‘æ³•é™¢\næ°‘äº‹åˆ¤å†³ä¹¦\n(199x)å»ºåˆå­—ç¬¬xxxå·\nåŸå‘Šï¼šå¼ ä¸‰ã€‚\nå§”æ‰˜ä»£ç†äººæå››ï¼ŒåŒ—äº¬å¸‚ Aå¾‹å¸ˆäº‹åŠ¡æ‰€å¾‹å¸ˆã€‚\nè¢«å‘Šï¼šBå…¬å¸ï¼Œæ³•å®šä»£è¡¨äººç‹äº”ï¼Œå¼€å‘å…¬å¸æ€»ç»ç†ã€‚\nå§”æ‰˜ä»£ç†äººèµµå…­ï¼ŒåŒ—äº¬å¸‚ Cå¾‹å¸ˆäº‹åŠ¡æ‰€å¾‹å¸ˆã€‚")) # Better print results using pprint
    [{'åŸå‘Š': [{'end': 37,
              'probability': 0.9949814024296764,
              'relations': {'å§”æ‰˜ä»£ç†äºº': [{'end': 46,
                                      'probability': 0.7956844697990384,
                                      'start': 44,
                                      'text': 'æå››'}]},
              'start': 35,
              'text': 'å¼ ä¸‰'}],
      'æ³•é™¢': [{'end': 10,
              'probability': 0.9221074192336651,
              'start': 0,
              'text': 'åŒ—äº¬å¸‚æµ·æ·€åŒºäººæ°‘æ³•é™¢'}],
      'è¢«å‘Š': [{'end': 67,
              'probability': 0.8437349536631089,
              'relations': {'å§”æ‰˜ä»£ç†äºº': [{'end': 92,
                                      'probability': 0.7267121388225029,
                                      'start': 90,
                                      'text': 'èµµå…­'}]},
              'start': 64,
              'text': 'Bå…¬å¸'}]}]
    ```

<a name="æ¨¡å‹é€‰æ‹©"></a>

#### 3.7 æ¨¡å‹é€‰æ‹©

- å¤šæ¨¡å‹é€‰æ‹©ï¼Œæ»¡è¶³ç²¾åº¦ã€é€Ÿåº¦è¦æ±‚

  | æ¨¡å‹ |  ç»“æ„  | è¯­è¨€ |
  | :---: | :--------: | :--------: |
  | `uie-base` (é»˜è®¤)| 12-layers, 768-hidden, 12-heads | ä¸­æ–‡ |
  | `uie-base-en` | 12-layers, 768-hidden, 12-heads | è‹±æ–‡ |
  | `uie-medical-base` | 12-layers, 768-hidden, 12-heads | ä¸­æ–‡ |
  | `uie-medium`| 6-layers, 768-hidden, 12-heads | ä¸­æ–‡ |
  | `uie-mini`| 6-layers, 384-hidden, 12-heads | ä¸­æ–‡ |
  | `uie-micro`| 4-layers, 384-hidden, 12-heads | ä¸­æ–‡ |
  | `uie-nano`| 4-layers, 312-hidden, 12-heads | ä¸­æ–‡ |
  | `uie-m-large`| 24-layers, 1024-hidden, 16-heads | ä¸­ã€è‹±æ–‡ |
  | `uie-m-base`| 12-layers, 768-hidden, 12-heads | ä¸­ã€è‹±æ–‡ |


- `uie-nano`è°ƒç”¨ç¤ºä¾‹ï¼š

  ```python
  >>> from paddlenlp import Taskflow

  >>> schema = ['æ—¶é—´', 'é€‰æ‰‹', 'èµ›äº‹åç§°']
  >>> ie = Taskflow('information_extraction', schema=schema, model="uie-nano")
  >>> ie("2æœˆ8æ—¥ä¸ŠåˆåŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›ä¸­ä¸­å›½é€‰æ‰‹è°·çˆ±å‡Œä»¥188.25åˆ†è·å¾—é‡‘ç‰Œï¼")
  [{'æ—¶é—´': [{'text': '2æœˆ8æ—¥ä¸Šåˆ', 'start': 0, 'end': 6, 'probability': 0.6513581678349247}], 'é€‰æ‰‹': [{'text': 'è°·çˆ±å‡Œ', 'start': 28, 'end': 31, 'probability': 0.9819330659468051}], 'èµ›äº‹åç§°': [{'text': 'åŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›', 'start': 6, 'end': 23, 'probability': 0.4908131110420939}]}]
  ```

- `uie-m-base`å’Œ`uie-m-large`æ”¯æŒä¸­è‹±æ–‡æ··åˆæŠ½å–ï¼Œè°ƒç”¨ç¤ºä¾‹ï¼š

  ```python
  >>> from pprint import pprint
  >>> from paddlenlp import Taskflow

  >>> schema = ['Time', 'Player', 'Competition', 'Score']
  >>> ie = Taskflow('information_extraction', schema=schema, model="uie-m-base", schema_lang="en")
  >>> pprint(ie(["2æœˆ8æ—¥ä¸ŠåˆåŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›ä¸­ä¸­å›½é€‰æ‰‹è°·çˆ±å‡Œä»¥188.25åˆ†è·å¾—é‡‘ç‰Œï¼", "Rafael Nadal wins French Open Final!"]))
  [{'Competition': [{'end': 23,
                    'probability': 0.9373889907291257,
                    'start': 6,
                    'text': 'åŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›'}],
    'Player': [{'end': 31,
                'probability': 0.6981119555336441,
                'start': 28,
                'text': 'è°·çˆ±å‡Œ'}],
    'Score': [{'end': 39,
              'probability': 0.9888507878270296,
              'start': 32,
              'text': '188.25åˆ†'}],
    'Time': [{'end': 6,
              'probability': 0.9784080036931151,
              'start': 0,
              'text': '2æœˆ8æ—¥ä¸Šåˆ'}]},
  {'Competition': [{'end': 35,
                    'probability': 0.9851549932171295,
                    'start': 18,
                    'text': 'French Open Final'}],
    'Player': [{'end': 12,
                'probability': 0.9379371275888104,
                'start': 0,
                'text': 'Rafael Nadal'}]}]
  ```

<a name="æ›´å¤šé…ç½®"></a>

#### 3.8 æ›´å¤šé…ç½®

```python
>>> from paddlenlp import Taskflow

>>> ie = Taskflow('information_extraction',
                  schema="",
                  schema_lang="zh",
                  batch_size=1,
                  model='uie-base',
                  position_prob=0.5,
                  precision='fp32',
                  use_fast=False)
```

* `schema`ï¼šå®šä¹‰ä»»åŠ¡æŠ½å–ç›®æ ‡ï¼Œå¯å‚è€ƒå¼€ç®±å³ç”¨ä¸­ä¸åŒä»»åŠ¡çš„è°ƒç”¨ç¤ºä¾‹è¿›è¡Œé…ç½®ã€‚
* `schema_lang`ï¼šè®¾ç½®schemaçš„è¯­è¨€ï¼Œé»˜è®¤ä¸º`zh`, å¯é€‰æœ‰`zh`å’Œ`en`ã€‚å› ä¸ºä¸­è‹±schemaçš„æ„é€ æœ‰æ‰€ä¸åŒï¼Œå› æ­¤éœ€è¦æŒ‡å®šschemaçš„è¯­è¨€ã€‚è¯¥å‚æ•°åªå¯¹`uie-m-base`å’Œ`uie-m-large`æ¨¡å‹æœ‰æ•ˆã€‚
* `batch_size`ï¼šæ‰¹å¤„ç†å¤§å°ï¼Œè¯·ç»“åˆæœºå™¨æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œé»˜è®¤ä¸º1ã€‚
* `model`ï¼šé€‰æ‹©ä»»åŠ¡ä½¿ç”¨çš„æ¨¡å‹ï¼Œé»˜è®¤ä¸º`uie-base`ï¼Œå¯é€‰æœ‰`uie-base`, `uie-medium`, `uie-mini`, `uie-micro`, `uie-nano`å’Œ`uie-medical-base`, `uie-base-en`ã€‚
* `position_prob`ï¼šæ¨¡å‹å¯¹äºspançš„èµ·å§‹ä½ç½®/ç»ˆæ­¢ä½ç½®çš„ç»“æœæ¦‚ç‡åœ¨0~1ä¹‹é—´ï¼Œè¿”å›ç»“æœå»æ‰å°äºè¿™ä¸ªé˜ˆå€¼çš„ç»“æœï¼Œé»˜è®¤ä¸º0.5ï¼Œspançš„æœ€ç»ˆæ¦‚ç‡è¾“å‡ºä¸ºèµ·å§‹ä½ç½®æ¦‚ç‡å’Œç»ˆæ­¢ä½ç½®æ¦‚ç‡çš„ä¹˜ç§¯ã€‚
* `precision`ï¼šé€‰æ‹©æ¨¡å‹ç²¾åº¦ï¼Œé»˜è®¤ä¸º`fp32`ï¼Œå¯é€‰æœ‰`fp16`å’Œ`fp32`ã€‚`fp16`æ¨ç†é€Ÿåº¦æ›´å¿«ï¼Œæ”¯æŒGPUå’ŒNPUç¡¬ä»¶ç¯å¢ƒã€‚å¦‚æœé€‰æ‹©`fp16`ï¼Œåœ¨GPUç¡¬ä»¶ç¯å¢ƒä¸‹ï¼Œè¯·å…ˆç¡®ä¿æœºå™¨æ­£ç¡®å®‰è£…NVIDIAç›¸å…³é©±åŠ¨å’ŒåŸºç¡€è½¯ä»¶ï¼Œ**ç¡®ä¿CUDA>=11.2ï¼ŒcuDNN>=8.1.1**ï¼Œåˆæ¬¡ä½¿ç”¨éœ€æŒ‰ç…§æç¤ºå®‰è£…ç›¸å…³ä¾èµ–ã€‚å…¶æ¬¡ï¼Œéœ€è¦ç¡®ä¿GPUè®¾å¤‡çš„CUDAè®¡ç®—èƒ½åŠ›ï¼ˆCUDA Compute Capabilityï¼‰å¤§äº7.0ï¼Œå…¸å‹çš„è®¾å¤‡åŒ…æ‹¬V100ã€T4ã€A10ã€A100ã€GTX 20ç³»åˆ—å’Œ30ç³»åˆ—æ˜¾å¡ç­‰ã€‚æ›´å¤šå…³äºCUDA Compute Capabilityå’Œç²¾åº¦æ”¯æŒæƒ…å†µè¯·å‚è€ƒNVIDIAæ–‡æ¡£ï¼š[GPUç¡¬ä»¶ä¸æ”¯æŒç²¾åº¦å¯¹ç…§è¡¨](https://docs.nvidia.com/deeplearning/tensorrt/archives/tensorrt-840-ea/support-matrix/index.html#hardware-precision-matrix)ã€‚
* `use_fast`: ä½¿ç”¨C++å®ç°çš„é«˜æ€§èƒ½åˆ†è¯ç®—å­FastTokenizerè¿›è¡Œæ–‡æœ¬é¢„å¤„ç†åŠ é€Ÿã€‚éœ€è¦é€šè¿‡`pip install fast-tokenizer-python`å®‰è£…FastTokenizeråº“åæ–¹å¯ä½¿ç”¨ã€‚é»˜è®¤ä¸º`False`ã€‚æ›´å¤šä½¿ç”¨è¯´æ˜å¯å‚è€ƒ[FastTokenizeræ–‡æ¡£](../../fast_tokenizer)ã€‚
<a name="è®­ç»ƒå®šåˆ¶"></a>

## 4. è®­ç»ƒå®šåˆ¶

å¯¹äºç®€å•çš„æŠ½å–ç›®æ ‡å¯ä»¥ç›´æ¥ä½¿ç”¨```paddlenlp.Taskflow```å®ç°é›¶æ ·æœ¬ï¼ˆzero-shotï¼‰æŠ½å–ï¼Œå¯¹äºç»†åˆ†åœºæ™¯æˆ‘ä»¬æ¨èä½¿ç”¨è½»å®šåˆ¶åŠŸèƒ½ï¼ˆæ ‡æ³¨å°‘é‡æ•°æ®è¿›è¡Œæ¨¡å‹å¾®è°ƒï¼‰ä»¥è¿›ä¸€æ­¥æå‡æ•ˆæœã€‚ä¸‹é¢é€šè¿‡`æŠ¥é”€å·¥å•ä¿¡æ¯æŠ½å–`çš„ä¾‹å­å±•ç¤ºå¦‚ä½•é€šè¿‡5æ¡è®­ç»ƒæ•°æ®è¿›è¡ŒUIEæ¨¡å‹å¾®è°ƒã€‚

<a name="ä»£ç ç»“æ„"></a>

#### 4.1 ä»£ç ç»“æ„

```shell
.
â”œâ”€â”€ utils.py          # æ•°æ®å¤„ç†å·¥å…·
â”œâ”€â”€ model.py          # æ¨¡å‹ç»„ç½‘è„šæœ¬
â”œâ”€â”€ doccano.py        # æ•°æ®æ ‡æ³¨è„šæœ¬
â”œâ”€â”€ doccano.md        # æ•°æ®æ ‡æ³¨æ–‡æ¡£
â”œâ”€â”€ finetune.py       # æ¨¡å‹å¾®è°ƒã€å‹ç¼©è„šæœ¬
â”œâ”€â”€ evaluate.py       # æ¨¡å‹è¯„ä¼°è„šæœ¬
â””â”€â”€ README.md
```

<a name="æ•°æ®æ ‡æ³¨"></a>

#### 4.2 æ•°æ®æ ‡æ³¨

æˆ‘ä»¬æ¨èä½¿ç”¨æ•°æ®æ ‡æ³¨å¹³å°[doccano](https://github.com/doccano/doccano) è¿›è¡Œæ•°æ®æ ‡æ³¨ï¼Œæœ¬ç¤ºä¾‹ä¹Ÿæ‰“é€šäº†ä»æ ‡æ³¨åˆ°è®­ç»ƒçš„é€šé“ï¼Œå³doccanoå¯¼å‡ºæ•°æ®åå¯é€šè¿‡[doccano.py](./doccano.py)è„šæœ¬è½»æ¾å°†æ•°æ®è½¬æ¢ä¸ºè¾“å…¥æ¨¡å‹æ—¶éœ€è¦çš„å½¢å¼ï¼Œå®ç°æ— ç¼è¡”æ¥ã€‚æ ‡æ³¨æ–¹æ³•çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ[doccanoæ•°æ®æ ‡æ³¨æŒ‡å—](doccano.md)ã€‚

åŸå§‹æ•°æ®ç¤ºä¾‹ï¼š

```text
æ·±å¤§åˆ°åŒé¾™28å—é’±4æœˆ24å·äº¤é€šè´¹
```

æŠ½å–çš„ç›®æ ‡(schema)ä¸ºï¼š

```python
schema = ['å‡ºå‘åœ°', 'ç›®çš„åœ°', 'è´¹ç”¨', 'æ—¶é—´']
```

æ ‡æ³¨æ­¥éª¤å¦‚ä¸‹ï¼š

- åœ¨doccanoå¹³å°ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªç±»å‹ä¸º``åºåˆ—æ ‡æ³¨``çš„æ ‡æ³¨é¡¹ç›®ã€‚
- å®šä¹‰å®ä½“æ ‡ç­¾ç±»åˆ«ï¼Œä¸Šä¾‹ä¸­éœ€è¦å®šä¹‰çš„å®ä½“æ ‡ç­¾æœ‰``å‡ºå‘åœ°``ã€``ç›®çš„åœ°``ã€``è´¹ç”¨``å’Œ``æ—¶é—´``ã€‚
- ä½¿ç”¨ä»¥ä¸Šå®šä¹‰çš„æ ‡ç­¾å¼€å§‹æ ‡æ³¨æ•°æ®ï¼Œä¸‹é¢å±•ç¤ºäº†ä¸€ä¸ªdoccanoæ ‡æ³¨ç¤ºä¾‹ï¼š

<div align="center">
    <img src=https://user-images.githubusercontent.com/40840292/167336891-afef1ad5-8777-456d-805b-9c65d9014b80.png height=100 hspace='10'/>
</div>

- æ ‡æ³¨å®Œæˆåï¼Œåœ¨doccanoå¹³å°ä¸Šå¯¼å‡ºæ–‡ä»¶ï¼Œå¹¶å°†å…¶é‡å‘½åä¸º``doccano_ext.json``åï¼Œæ”¾å…¥``./data``ç›®å½•ä¸‹ã€‚

- è¿™é‡Œæˆ‘ä»¬æä¾›é¢„å…ˆæ ‡æ³¨å¥½çš„æ–‡ä»¶[doccano_ext.json](https://bj.bcebos.com/paddlenlp/datasets/uie/doccano_ext.json)ï¼Œå¯ç›´æ¥ä¸‹è½½å¹¶æ”¾å…¥`./data`ç›®å½•ã€‚æ‰§è¡Œä»¥ä¸‹è„šæœ¬è¿›è¡Œæ•°æ®è½¬æ¢ï¼Œæ‰§è¡Œåä¼šåœ¨`./data`ç›®å½•ä¸‹ç”Ÿæˆè®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†æ–‡ä»¶ã€‚

```shell
python doccano.py \
    --doccano_file ./data/doccano_ext.json \
    --task_type ext \
    --save_dir ./data \
    --splits 0.8 0.2 0 \
    --schema_lang ch
```


å¯é…ç½®å‚æ•°è¯´æ˜ï¼š

- ``doccano_file``: ä»doccanoå¯¼å‡ºçš„æ•°æ®æ ‡æ³¨æ–‡ä»¶ã€‚
- ``save_dir``: è®­ç»ƒæ•°æ®çš„ä¿å­˜ç›®å½•ï¼Œé»˜è®¤å­˜å‚¨åœ¨``data``ç›®å½•ä¸‹ã€‚
- ``negative_ratio``: æœ€å¤§è´Ÿä¾‹æ¯”ä¾‹ï¼Œè¯¥å‚æ•°åªå¯¹æŠ½å–ç±»å‹ä»»åŠ¡æœ‰æ•ˆï¼Œé€‚å½“æ„é€ è´Ÿä¾‹å¯æå‡æ¨¡å‹æ•ˆæœã€‚è´Ÿä¾‹æ•°é‡å’Œå®é™…çš„æ ‡ç­¾æ•°é‡æœ‰å…³ï¼Œæœ€å¤§è´Ÿä¾‹æ•°é‡ = negative_ratio * æ­£ä¾‹æ•°é‡ã€‚è¯¥å‚æ•°åªå¯¹è®­ç»ƒé›†æœ‰æ•ˆï¼Œé»˜è®¤ä¸º5ã€‚ä¸ºäº†ä¿è¯è¯„ä¼°æŒ‡æ ‡çš„å‡†ç¡®æ€§ï¼ŒéªŒè¯é›†å’Œæµ‹è¯•é›†é»˜è®¤æ„é€ å…¨è´Ÿä¾‹ã€‚
- ``splits``: åˆ’åˆ†æ•°æ®é›†æ—¶è®­ç»ƒé›†ã€éªŒè¯é›†æ‰€å çš„æ¯”ä¾‹ã€‚é»˜è®¤ä¸º[0.8, 0.1, 0.1]è¡¨ç¤ºæŒ‰ç…§``8:1:1``çš„æ¯”ä¾‹å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚
- ``task_type``: é€‰æ‹©ä»»åŠ¡ç±»å‹ï¼Œå¯é€‰æœ‰æŠ½å–å’Œåˆ†ç±»ä¸¤ç§ç±»å‹çš„ä»»åŠ¡ã€‚
- ``options``: æŒ‡å®šåˆ†ç±»ä»»åŠ¡çš„ç±»åˆ«æ ‡ç­¾ï¼Œè¯¥å‚æ•°åªå¯¹åˆ†ç±»ç±»å‹ä»»åŠ¡æœ‰æ•ˆã€‚é»˜è®¤ä¸º["æ­£å‘", "è´Ÿå‘"]ã€‚
- ``prompt_prefix``: å£°æ˜åˆ†ç±»ä»»åŠ¡çš„promptå‰ç¼€ä¿¡æ¯ï¼Œè¯¥å‚æ•°åªå¯¹åˆ†ç±»ç±»å‹ä»»åŠ¡æœ‰æ•ˆã€‚é»˜è®¤ä¸º"æƒ…æ„Ÿå€¾å‘"ã€‚
- ``is_shuffle``: æ˜¯å¦å¯¹æ•°æ®é›†è¿›è¡Œéšæœºæ‰“æ•£ï¼Œé»˜è®¤ä¸ºTrueã€‚
- ``seed``: éšæœºç§å­ï¼Œé»˜è®¤ä¸º1000.
- ``separator``: å®ä½“ç±»åˆ«/è¯„ä»·ç»´åº¦ä¸åˆ†ç±»æ ‡ç­¾çš„åˆ†éš”ç¬¦ï¼Œè¯¥å‚æ•°åªå¯¹å®ä½“/è¯„ä»·ç»´åº¦çº§åˆ†ç±»ä»»åŠ¡æœ‰æ•ˆã€‚é»˜è®¤ä¸º"##"ã€‚
- ``schema_lang``: é€‰æ‹©schemaçš„è¯­è¨€ï¼Œå¯é€‰æœ‰`ch`å’Œ`en`ã€‚é»˜è®¤ä¸º`ch`ï¼Œè‹±æ–‡æ•°æ®é›†è¯·é€‰æ‹©`en`ã€‚

å¤‡æ³¨ï¼š
- é»˜è®¤æƒ…å†µä¸‹ [doccano.py](./doccano.py) è„šæœ¬ä¼šæŒ‰ç…§æ¯”ä¾‹å°†æ•°æ®åˆ’åˆ†ä¸º train/dev/test æ•°æ®é›†
- æ¯æ¬¡æ‰§è¡Œ [doccano.py](./doccano.py) è„šæœ¬ï¼Œå°†ä¼šè¦†ç›–å·²æœ‰çš„åŒåæ•°æ®æ–‡ä»¶
- åœ¨æ¨¡å‹è®­ç»ƒé˜¶æ®µæˆ‘ä»¬æ¨èæ„é€ ä¸€äº›è´Ÿä¾‹ä»¥æå‡æ¨¡å‹æ•ˆæœï¼Œåœ¨æ•°æ®è½¬æ¢é˜¶æ®µæˆ‘ä»¬å†…ç½®äº†è¿™ä¸€åŠŸèƒ½ã€‚å¯é€šè¿‡`negative_ratio`æ§åˆ¶è‡ªåŠ¨æ„é€ çš„è´Ÿæ ·æœ¬æ¯”ä¾‹ï¼›è´Ÿæ ·æœ¬æ•°é‡ = negative_ratio * æ­£æ ·æœ¬æ•°é‡ã€‚
- å¯¹äºä»doccanoå¯¼å‡ºçš„æ–‡ä»¶ï¼Œé»˜è®¤æ–‡ä»¶ä¸­çš„æ¯æ¡æ•°æ®éƒ½æ˜¯ç»è¿‡äººå·¥æ­£ç¡®æ ‡æ³¨çš„ã€‚

æ›´å¤š**ä¸åŒç±»å‹ä»»åŠ¡ï¼ˆå…³ç³»æŠ½å–ã€äº‹ä»¶æŠ½å–ã€è¯„ä»·è§‚ç‚¹æŠ½å–ç­‰ï¼‰çš„æ ‡æ³¨è§„åˆ™åŠå‚æ•°è¯´æ˜**ï¼Œè¯·å‚è€ƒ[doccanoæ•°æ®æ ‡æ³¨æŒ‡å—](doccano.md)ã€‚

æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ•°æ®æ ‡æ³¨å¹³å° [Label Studio](https://labelstud.io/) è¿›è¡Œæ•°æ®æ ‡æ³¨ã€‚æœ¬ç¤ºä¾‹æä¾›äº† [labelstudio2doccano.py](./labelstudio2doccano.py) è„šæœ¬ï¼Œå°† label studio å¯¼å‡ºçš„ JSON æ•°æ®æ–‡ä»¶æ ¼å¼è½¬æ¢æˆ doccano å¯¼å‡ºçš„æ•°æ®æ–‡ä»¶æ ¼å¼ï¼Œåç»­çš„æ•°æ®è½¬æ¢ä¸æ¨¡å‹å¾®è°ƒç­‰æ“ä½œä¸å˜ã€‚

```shell
python labelstudio2doccano.py --labelstudio_file label-studio.json
```

å¯é…ç½®å‚æ•°è¯´æ˜ï¼š

- ``labelstudio_file``: label studio çš„å¯¼å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆä»…æ”¯æŒ JSON æ ¼å¼ï¼‰ã€‚
- ``doccano_file``: doccano æ ¼å¼çš„æ•°æ®æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œé»˜è®¤ä¸º "doccano_ext.jsonl"ã€‚
- ``task_type``: ä»»åŠ¡ç±»å‹ï¼Œå¯é€‰æœ‰æŠ½å–ï¼ˆ"ext"ï¼‰å’Œåˆ†ç±»ï¼ˆ"cls"ï¼‰ä¸¤ç§ç±»å‹çš„ä»»åŠ¡ï¼Œé»˜è®¤ä¸º "ext"ã€‚

<a name="æ¨¡å‹å¾®è°ƒ"></a>

#### 4.3 æ¨¡å‹å¾®è°ƒ

æ¨èä½¿ç”¨ [Trainer API ](../../docs/trainer.md) å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚åªéœ€è¾“å…¥æ¨¡å‹ã€æ•°æ®é›†ç­‰å°±å¯ä»¥ä½¿ç”¨ Trainer API é«˜æ•ˆå¿«é€Ÿåœ°è¿›è¡Œé¢„è®­ç»ƒã€å¾®è°ƒå’Œæ¨¡å‹å‹ç¼©ç­‰ä»»åŠ¡ï¼Œå¯ä»¥ä¸€é”®å¯åŠ¨å¤šå¡è®­ç»ƒã€æ··åˆç²¾åº¦è®­ç»ƒã€æ¢¯åº¦ç´¯ç§¯ã€æ–­ç‚¹é‡å¯ã€æ—¥å¿—æ˜¾ç¤ºç­‰åŠŸèƒ½ï¼ŒTrainer API è¿˜é’ˆå¯¹è®­ç»ƒè¿‡ç¨‹çš„é€šç”¨è®­ç»ƒé…ç½®åšäº†å°è£…ï¼Œæ¯”å¦‚ï¼šä¼˜åŒ–å™¨ã€å­¦ä¹ ç‡è°ƒåº¦ç­‰ã€‚

ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œä½¿ç”¨ `uie-base` ä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œæ¨¡å‹å¾®è°ƒï¼Œå°†å¾®è°ƒåçš„æ¨¡å‹ä¿å­˜è‡³`$finetuned_model`ï¼š

å•å¡å¯åŠ¨ï¼š

```shell
export finetuned_model=./checkpoint/model_best

python finetune.py  \
    --device gpu \
    --logging_steps 10 \
    --save_steps 100 \
    --eval_steps 100 \
    --seed 42 \
    --model_name_or_path uie-base \
    --output_dir $finetuned_model \
    --train_path data/train.txt \
    --dev_path data/dev.txt  \
    --max_seq_length 512  \
    --per_device_eval_batch_size 16 \
    --per_device_train_batch_size  16 \
    --num_train_epochs 20 \
    --learning_rate 1e-5 \
    --label_names "start_positions" "end_positions" \
    --do_train \
    --do_eval \
    --do_export \
    --export_model_dir $finetuned_model \
    --overwrite_output_dir \
    --disable_tqdm True \
    --metric_for_best_model eval_f1 \
    --load_best_model_at_end  True \
    --save_total_limit 1

```

å¦‚æœåœ¨GPUç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥æŒ‡å®šgpuså‚æ•°è¿›è¡Œå¤šå¡è®­ç»ƒï¼š

```shell
export finetuned_model=./checkpoint/model_best

python -u -m paddle.distributed.launch --gpus "0,1" finetune.py \
    --device gpu \
    --logging_steps 10 \
    --save_steps 100 \
    --eval_steps 100 \
    --seed 42 \
    --model_name_or_path uie-base \
    --output_dir $finetuned_model \
    --train_path data/train.txt \
    --dev_path data/dev.txt  \
    --max_seq_length 512  \
    --per_device_eval_batch_size 16 \
    --per_device_train_batch_size  16 \
    --num_train_epochs 100 \
    --learning_rate 1e-5 \
    --do_train \
    --do_eval \
    --do_export \
    --export_model_dir $finetuned_model \
    --label_names "start_positions" "end_positions" \
    --overwrite_output_dir \
    --disable_tqdm True \
    --metric_for_best_model eval_f1 \
    --load_best_model_at_end  True \
    --save_total_limit 1 \

```
**æ³¨æ„**ï¼šå¦‚æœæ¨¡å‹æ˜¯è·¨è¯­è¨€æ¨¡å‹ UIE-Mï¼Œè¿˜éœ€è®¾ç½® `--multilingual`ã€‚

å¯é…ç½®å‚æ•°è¯´æ˜ï¼š

* `model_name_or_path`ï¼šå¿…é¡»ï¼Œè¿›è¡Œ few shot è®­ç»ƒä½¿ç”¨çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚å¯é€‰æ‹©çš„æœ‰ "uie-base"ã€ "uie-medium", "uie-mini", "uie-micro", "uie-nano", "uie-m-base", "uie-m-large"ã€‚
* `multilingual`ï¼šæ˜¯å¦æ˜¯è·¨è¯­è¨€æ¨¡å‹ï¼Œç”¨ "uie-m-base", "uie-m-large" ç­‰æ¨¡å‹è¿›å¾®è°ƒå¾—åˆ°çš„æ¨¡å‹ä¹Ÿæ˜¯å¤šè¯­è¨€æ¨¡å‹ï¼Œéœ€è¦è®¾ç½®ä¸º Trueï¼›é»˜è®¤ä¸º Falseã€‚
* `output_dir`ï¼šå¿…é¡»ï¼Œæ¨¡å‹è®­ç»ƒæˆ–å‹ç¼©åä¿å­˜çš„æ¨¡å‹ç›®å½•ï¼›é»˜è®¤ä¸º `None` ã€‚
* `device`: è®­ç»ƒè®¾å¤‡ï¼Œå¯é€‰æ‹© 'cpu'ã€'gpu' ã€'npu'å…¶ä¸­çš„ä¸€ç§ï¼›é»˜è®¤ä¸º GPU è®­ç»ƒã€‚
* `per_device_train_batch_size`ï¼šè®­ç»ƒé›†è®­ç»ƒè¿‡ç¨‹æ‰¹å¤„ç†å¤§å°ï¼Œè¯·ç»“åˆæ˜¾å­˜æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œè‹¥å‡ºç°æ˜¾å­˜ä¸è¶³ï¼Œè¯·é€‚å½“è°ƒä½è¿™ä¸€å‚æ•°ï¼›é»˜è®¤ä¸º 32ã€‚
* `per_device_eval_batch_size`ï¼šå¼€å‘é›†è¯„æµ‹è¿‡ç¨‹æ‰¹å¤„ç†å¤§å°ï¼Œè¯·ç»“åˆæ˜¾å­˜æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œè‹¥å‡ºç°æ˜¾å­˜ä¸è¶³ï¼Œè¯·é€‚å½“è°ƒä½è¿™ä¸€å‚æ•°ï¼›é»˜è®¤ä¸º 32ã€‚
* `learning_rate`ï¼šè®­ç»ƒæœ€å¤§å­¦ä¹ ç‡ï¼ŒUIE æ¨èè®¾ç½®ä¸º 1e-5ï¼›é»˜è®¤å€¼ä¸º3e-5ã€‚
* `num_train_epochs`: è®­ç»ƒè½®æ¬¡ï¼Œä½¿ç”¨æ—©åœæ³•æ—¶å¯ä»¥é€‰æ‹© 100ï¼›é»˜è®¤ä¸º10ã€‚
* `logging_steps`: è®­ç»ƒè¿‡ç¨‹ä¸­æ—¥å¿—æ‰“å°çš„é—´éš” steps æ•°ï¼Œé»˜è®¤100ã€‚
* `save_steps`: è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜æ¨¡å‹ checkpoint çš„é—´éš” steps æ•°ï¼Œé»˜è®¤100ã€‚
* `seed`ï¼šå…¨å±€éšæœºç§å­ï¼Œé»˜è®¤ä¸º 42ã€‚
* `weight_decay`ï¼šé™¤äº†æ‰€æœ‰ bias å’Œ LayerNorm æƒé‡ä¹‹å¤–ï¼Œåº”ç”¨äºæ‰€æœ‰å±‚çš„æƒé‡è¡°å‡æ•°å€¼ã€‚å¯é€‰ï¼›é»˜è®¤ä¸º 0.0ï¼›
* `do_train`:æ˜¯å¦è¿›è¡Œå¾®è°ƒè®­ç»ƒï¼Œè®¾ç½®è¯¥å‚æ•°è¡¨ç¤ºè¿›è¡Œå¾®è°ƒè®­ç»ƒï¼Œé»˜è®¤ä¸è®¾ç½®ã€‚
* `do_eval`:æ˜¯å¦è¿›è¡Œè¯„ä¼°ï¼Œè®¾ç½®è¯¥å‚æ•°è¡¨ç¤ºè¿›è¡Œè¯„ä¼°ã€‚

è¯¥ç¤ºä¾‹ä»£ç ä¸­ç”±äºè®¾ç½®äº†å‚æ•° `--do_eval`ï¼Œå› æ­¤åœ¨è®­ç»ƒå®Œä¼šè‡ªåŠ¨è¿›è¡Œè¯„ä¼°ã€‚

<a name="æ¨¡å‹è¯„ä¼°"></a>

#### 4.4 æ¨¡å‹è¯„ä¼°

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ¨¡å‹è¯„ä¼°ï¼š

```shell
python evaluate.py \
    --model_path ./checkpoint/model_best \
    --test_path ./data/dev.txt \
    --batch_size 16 \
    --max_seq_len 512
```

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¹ UIE-M è¿›è¡Œæ¨¡å‹è¯„ä¼°ï¼š

```
python evaluate.py \
    --model_path ./checkpoint/model_best \
    --test_path ./data/dev.txt \
    --batch_size 16 \
    --max_seq_len 512 \
    --multilingual
```

è¯„ä¼°æ–¹å¼è¯´æ˜ï¼šé‡‡ç”¨å•é˜¶æ®µè¯„ä»·çš„æ–¹å¼ï¼Œå³å…³ç³»æŠ½å–ã€äº‹ä»¶æŠ½å–ç­‰éœ€è¦åˆ†é˜¶æ®µé¢„æµ‹çš„ä»»åŠ¡å¯¹æ¯ä¸€é˜¶æ®µçš„é¢„æµ‹ç»“æœè¿›è¡Œåˆ†åˆ«è¯„ä»·ã€‚éªŒè¯/æµ‹è¯•é›†é»˜è®¤ä¼šåˆ©ç”¨åŒä¸€å±‚çº§çš„æ‰€æœ‰æ ‡ç­¾æ¥æ„é€ å‡ºå…¨éƒ¨è´Ÿä¾‹ã€‚

å¯å¼€å¯`debug`æ¨¡å¼å¯¹æ¯ä¸ªæ­£ä¾‹ç±»åˆ«åˆ†åˆ«è¿›è¡Œè¯„ä¼°ï¼Œè¯¥æ¨¡å¼ä»…ç”¨äºæ¨¡å‹è°ƒè¯•ï¼š

```shell
python evaluate.py \
    --model_path ./checkpoint/model_best \
    --test_path ./data/dev.txt \
    --debug
```

è¾“å‡ºæ‰“å°ç¤ºä¾‹ï¼š

```text
[2022-09-14 03:13:58,877] [    INFO] - -----------------------------
[2022-09-14 03:13:58,877] [    INFO] - Class Name: ç–¾ç—…
[2022-09-14 03:13:58,877] [    INFO] - Evaluation Precision: 0.89744 | Recall: 0.83333 | F1: 0.86420
[2022-09-14 03:13:59,145] [    INFO] - -----------------------------
[2022-09-14 03:13:59,145] [    INFO] - Class Name: æ‰‹æœ¯æ²»ç–—
[2022-09-14 03:13:59,145] [    INFO] - Evaluation Precision: 0.90000 | Recall: 0.85714 | F1: 0.87805
[2022-09-14 03:13:59,439] [    INFO] - -----------------------------
[2022-09-14 03:13:59,440] [    INFO] - Class Name: æ£€æŸ¥
[2022-09-14 03:13:59,440] [    INFO] - Evaluation Precision: 0.77778 | Recall: 0.56757 | F1: 0.65625
[2022-09-14 03:13:59,708] [    INFO] - -----------------------------
[2022-09-14 03:13:59,709] [    INFO] - Class Name: Xçš„æ‰‹æœ¯æ²»ç–—
[2022-09-14 03:13:59,709] [    INFO] - Evaluation Precision: 0.90000 | Recall: 0.85714 | F1: 0.87805
[2022-09-14 03:13:59,893] [    INFO] - -----------------------------
[2022-09-14 03:13:59,893] [    INFO] - Class Name: Xçš„å®éªŒå®¤æ£€æŸ¥
[2022-09-14 03:13:59,894] [    INFO] - Evaluation Precision: 0.71429 | Recall: 0.55556 | F1: 0.62500
[2022-09-14 03:14:00,057] [    INFO] - -----------------------------
[2022-09-14 03:14:00,058] [    INFO] - Class Name: Xçš„å½±åƒå­¦æ£€æŸ¥
[2022-09-14 03:14:00,058] [    INFO] - Evaluation Precision: 0.69231 | Recall: 0.45000 | F1: 0.54545
```

å¯é…ç½®å‚æ•°è¯´æ˜ï¼š

- `model_path`: è¿›è¡Œè¯„ä¼°çš„æ¨¡å‹æ–‡ä»¶å¤¹è·¯å¾„ï¼Œè·¯å¾„ä¸‹éœ€åŒ…å«æ¨¡å‹æƒé‡æ–‡ä»¶`model_state.pdparams`åŠé…ç½®æ–‡ä»¶`model_config.json`ã€‚
- `test_path`: è¿›è¡Œè¯„ä¼°çš„æµ‹è¯•é›†æ–‡ä»¶ã€‚
- `batch_size`: æ‰¹å¤„ç†å¤§å°ï¼Œè¯·ç»“åˆæœºå™¨æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œé»˜è®¤ä¸º16ã€‚
- `max_seq_len`: æ–‡æœ¬æœ€å¤§åˆ‡åˆ†é•¿åº¦ï¼Œè¾“å…¥è¶…è¿‡æœ€å¤§é•¿åº¦æ—¶ä¼šå¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œè‡ªåŠ¨åˆ‡åˆ†ï¼Œé»˜è®¤ä¸º512ã€‚
- `debug`: æ˜¯å¦å¼€å¯debugæ¨¡å¼å¯¹æ¯ä¸ªæ­£ä¾‹ç±»åˆ«åˆ†åˆ«è¿›è¡Œè¯„ä¼°ï¼Œè¯¥æ¨¡å¼ä»…ç”¨äºæ¨¡å‹è°ƒè¯•ï¼Œé»˜è®¤å…³é—­ã€‚
- `multilingual`: æ˜¯å¦æ˜¯è·¨è¯­è¨€æ¨¡å‹ï¼Œé»˜è®¤å…³é—­ã€‚
- `schema_lang`: é€‰æ‹©schemaçš„è¯­è¨€ï¼Œå¯é€‰æœ‰`ch`å’Œ`en`ã€‚é»˜è®¤ä¸º`ch`ï¼Œè‹±æ–‡æ•°æ®é›†è¯·é€‰æ‹©`en`ã€‚

<a name="å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹"></a>

#### 4.5 å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹

`paddlenlp.Taskflow`è£…è½½å®šåˆ¶æ¨¡å‹ï¼Œé€šè¿‡`task_path`æŒ‡å®šæ¨¡å‹æƒé‡æ–‡ä»¶çš„è·¯å¾„ï¼Œè·¯å¾„ä¸‹éœ€è¦åŒ…å«è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡æ–‡ä»¶`model_state.pdparams`ã€‚

```python
>>> from pprint import pprint
>>> from paddlenlp import Taskflow

>>> schema = ['å‡ºå‘åœ°', 'ç›®çš„åœ°', 'è´¹ç”¨', 'æ—¶é—´']
# è®¾å®šæŠ½å–ç›®æ ‡å’Œå®šåˆ¶åŒ–æ¨¡å‹æƒé‡è·¯å¾„
>>> my_ie = Taskflow("information_extraction", schema=schema, task_path='./checkpoint/model_best')
>>> pprint(my_ie("åŸå¸‚å†…äº¤é€šè´¹7æœˆ5æ—¥é‡‘é¢114å¹¿å·è‡³ä½›å±±"))
[{'å‡ºå‘åœ°': [{'end': 17,
           'probability': 0.9975287467835301,
           'start': 15,
           'text': 'å¹¿å·'}],
  'æ—¶é—´': [{'end': 10,
          'probability': 0.9999476678061399,
          'start': 6,
          'text': '7æœˆ5æ—¥'}],
  'ç›®çš„åœ°': [{'end': 20,
           'probability': 0.9998511131226735,
           'start': 18,
           'text': 'ä½›å±±'}],
  'è´¹ç”¨': [{'end': 15,
          'probability': 0.9994474579292856,
          'start': 12,
          'text': '114'}]}]
```

<a name="æ¨¡å‹å¿«é€ŸæœåŠ¡åŒ–éƒ¨ç½²"></a>

#### 4.6 æ¨¡å‹å¿«é€ŸæœåŠ¡åŒ–éƒ¨ç½²
åœ¨UIEçš„æœåŠ¡åŒ–èƒ½åŠ›ä¸­æˆ‘ä»¬æä¾›åŸºäºPaddleNLP SimpleServing æ¥æ­å»ºæœåŠ¡åŒ–èƒ½åŠ›ï¼Œé€šè¿‡å‡ è¡Œä»£ç å³å¯æ­å»ºæœåŠ¡åŒ–éƒ¨ç½²èƒ½åŠ›

```python

# Save at server.py
from paddlenlp import SimpleServer
from paddlenlp import Taskflow

schema = ['å‡ºå‘åœ°', 'ç›®çš„åœ°', 'è´¹ç”¨', 'æ—¶é—´']
uie = Taskflow("information_extraction",
               schema=schema,
               task_path='./checkpoint/model_best/')
app = SimpleServer()
app.register_taskflow('uie', uie)
```

```bash
# Start the server
paddlenlp server server:app --host 0.0.0.0 --port 8989
```

å…·ä½“ä½¿ç”¨çš„æ–¹æ³•å¯ä»¥è§[UIE SimpleServing ä½¿ç”¨æ–¹æ³•](./deploy/serving/simple_serving/README.md)


<a name="å®éªŒæŒ‡æ ‡"></a>

#### 4.7 å®éªŒæŒ‡æ ‡

æˆ‘ä»¬åœ¨äº’è”ç½‘ã€åŒ»ç–—ã€é‡‘èä¸‰å¤§å‚ç±»è‡ªå»ºæµ‹è¯•é›†ä¸Šè¿›è¡Œäº†å®éªŒï¼š

<table>
<tr><th row_span='2'><th colspan='2'>é‡‘è<th colspan='2'>åŒ»ç–—<th colspan='2'>äº’è”ç½‘
<tr><td><th>0-shot<th>5-shot<th>0-shot<th>5-shot<th>0-shot<th>5-shot
<tr><td>uie-base (12L768H)<td>46.43<td>70.92<td><b>71.83</b><td>85.72<td>78.33<td>81.86
<tr><td>uie-medium (6L768H)<td>41.11<td>64.53<td>65.40<td>75.72<td>78.32<td>79.68
<tr><td>uie-mini (6L384H)<td>37.04<td>64.65<td>60.50<td>78.36<td>72.09<td>76.38
<tr><td>uie-micro (4L384H)<td>37.53<td>62.11<td>57.04<td>75.92<td>66.00<td>70.22
<tr><td>uie-nano (4L312H)<td>38.94<td>66.83<td>48.29<td>76.74<td>62.86<td>72.35
<tr><td>uie-m-large (24L1024H)<td><b>49.35</b><td><b>74.55</b><td>70.50<td><b>92.66</b><td><b>78.49</b><td><b>83.02</b>
<tr><td>uie-m-base (12L768H)<td>38.46<td>74.31<td>63.37<td>87.32<td>76.27<td>80.13
</table>

0-shotè¡¨ç¤ºæ— è®­ç»ƒæ•°æ®ç›´æ¥é€šè¿‡```paddlenlp.Taskflow```è¿›è¡Œé¢„æµ‹ï¼Œ5-shotè¡¨ç¤ºæ¯ä¸ªç±»åˆ«åŒ…å«5æ¡æ ‡æ³¨æ•°æ®è¿›è¡Œæ¨¡å‹å¾®è°ƒã€‚**å®éªŒè¡¨æ˜UIEåœ¨å‚ç±»åœºæ™¯å¯ä»¥é€šè¿‡å°‘é‡æ•°æ®ï¼ˆfew-shotï¼‰è¿›ä¸€æ­¥æå‡æ•ˆæœ**ã€‚


<a name="æ¨¡å‹éƒ¨ç½²"></a>

#### 4.8 æ¨¡å‹éƒ¨ç½²

ä»¥ä¸‹æ˜¯ UIE Python ç«¯çš„éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬ç¯å¢ƒå‡†å¤‡ã€æ¨¡å‹å¯¼å‡ºå’Œä½¿ç”¨ç¤ºä¾‹ã€‚


- æ¨¡å‹å¯¼å‡º

æ¨¡å‹è®­ç»ƒã€å‹ç¼©æ—¶å·²ç»è‡ªåŠ¨è¿›è¡Œäº†é™æ€å›¾çš„å¯¼å‡ºä»¥åŠ tokenizer é…ç½®æ–‡ä»¶ä¿å­˜ï¼Œä¿å­˜è·¯å¾„`${finetuned_model}` ä¸‹åº”è¯¥æœ‰ `*.pdimodel`ã€`*.pdiparams` æ¨¡å‹æ–‡ä»¶å¯ç”¨äºæ¨ç†ã€‚

- æ¨¡å‹éƒ¨ç½²

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•åŸºäº FastDeploy åº“å®Œæˆ UIE æ¨¡å‹å®Œæˆé€šç”¨ä¿¡æ¯æŠ½å–ä»»åŠ¡çš„ Python é¢„æµ‹éƒ¨ç½²ã€‚å…ˆå‚è€ƒ [UIE æ¨¡å‹éƒ¨ç½²](./deploy/python/README.md)å®‰è£…FastDeploy Python ä¾èµ–åŒ…ã€‚ å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°`--device`ä»¥åŠ`--backend`æŒ‡å®šè¿è¡Œåœ¨ä¸åŒçš„ç¡¬ä»¶ä»¥åŠæ¨ç†å¼•æ“åç«¯ï¼Œå¹¶ä½¿ç”¨`--model_dir`å‚æ•°æŒ‡å®šè¿è¡Œçš„æ¨¡å‹ã€‚æ¨¡å‹ç›®å½•ä¸º `model_zoo/uie/checkpoint/model_best`ï¼ˆç”¨æˆ·å¯æŒ‰å®é™…æƒ…å†µè®¾ç½®ï¼‰ã€‚

```bash
# UIE æ¨¡å‹ CPU æ¨ç†
python deploy/python/infer.py --model_dir ./checkpoint/model_best --device cpu
# UIE æ¨¡å‹ GPU æ¨ç†
python deploy/python/infer.py --model_dir ./checkpoint/model_best --device gpu

# UIE-M æ¨¡å‹ CPU æ¨ç†
python deploy/python/infer.py --model_dir ./checkpoint/model_best --device cpu --multilingual
# UIE-M æ¨¡å‹ GPU æ¨ç†
python deploy/python/infer.py --model_dir ./checkpoint/model_best --device gpu --multilingual
```

è¿è¡Œå®Œæˆåè¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š

```bash
[2023-03-06 03:31:21,456] [    INFO] - We are using <class 'paddlenlp.transformers.ernie.tokenizer.ErnieTokenizer'> to load 'export'.
[INFO] fastdeploy/runtime/runtime.cc(91)::AutoSelectBackend    FastDeploy will choose Backend::PDINFER to inference this model.
[INFO] fastdeploy/runtime/runtime.cc(266)::CreatePaddleBackend    Runtime initialized with Backend::PDINFER in Device::GPU.
-----------------------------
1. Input text:
"åŒ—äº¬å¸‚æµ·æ·€åŒºäººæ°‘æ³•é™¢
æ°‘äº‹åˆ¤å†³ä¹¦
(199x)å»ºåˆå­—ç¬¬xxxå·
åŸå‘Šï¼šå¼ ä¸‰ã€‚
å§”æ‰˜ä»£ç†äººæå››ï¼ŒåŒ—äº¬å¸‚ Aå¾‹å¸ˆäº‹åŠ¡æ‰€å¾‹å¸ˆã€‚
è¢«å‘Šï¼šBå…¬å¸ï¼Œæ³•å®šä»£è¡¨äººç‹äº”ï¼Œå¼€å‘å…¬å¸æ€»ç»ç†ã€‚
å§”æ‰˜ä»£ç†äººèµµå…­ï¼ŒåŒ—äº¬å¸‚ Cå¾‹å¸ˆäº‹åŠ¡æ‰€å¾‹å¸ˆã€‚"
2. Input schema:
['æ³•é™¢', {'åŸå‘Š': 'å§”æ‰˜ä»£ç†äºº'}, {'è¢«å‘Š': 'å§”æ‰˜ä»£ç†äºº'}]
3. Result:
{'åŸå‘Š': [{'end': 38,
         'probability': 0.9991321038858274,
         'relations': {'å§”æ‰˜ä»£ç†äºº': [{'end': 47,
                                  'probability': 0.8729063160951966,
                                  'start': 45,
                                  'text': 'æå››'}]},
         'start': 36,
         'text': 'å¼ ä¸‰'}],
 'æ³•é™¢': [{'end': 11,
         'probability': 0.9766876070751707,
         'start': 1,
         'text': 'åŒ—äº¬å¸‚æµ·æ·€åŒºäººæ°‘æ³•é™¢'}],
 'è¢«å‘Š': [{'end': 68,
         'probability': 0.9532207287016696,
         'relations': {'å§”æ‰˜ä»£ç†äºº': [{'end': 93,
                                  'probability': 0.7685119772607152,
                                  'start': 91,
                                  'text': 'èµµå…­'}]},
         'start': 65,
         'text': 'Bå…¬å¸'}]}
......
```

æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ[UIE Python éƒ¨ç½²æ–¹æ³•](./deploy/python/README.md)

<a name="CCKSæ¯”èµ›"></a>

## 5.CCKSæ¯”èµ›

ä¸ºäº†è¿›ä¸€æ­¥æ¢ç´¢é€šç”¨ä¿¡æ¯æŠ½å–çš„è¾¹ç•Œï¼Œæˆ‘ä»¬ä¸¾åŠäº†**CCKS 2022 åƒè¨€é€šç”¨ä¿¡æ¯æŠ½å–ç«èµ›è¯„æµ‹**ï¼ˆ2022/03/30 - 2022/07/31ï¼‰ã€‚

- [æŠ¥åé“¾æ¥](https://aistudio.baidu.com/aistudio/competition/detail/161/0/introduction)
- [åŸºçº¿ä»£ç ](https://github.com/PaddlePaddle/PaddleNLP/tree/develop/examples/information_extraction/DuUIE)

## References
- **[Unified Structure Generation for Universal Information Extraction](https://arxiv.org/pdf/2203.12277.pdf)**
- **[Quantizing deep convolutional networks for efficient inference: A whitepaper](https://arxiv.org/pdf/1806.08342.pdf)**
- **[PACT: Parameterized Clipping Activation for Quantized Neural Networks](https://arxiv.org/abs/1805.06085)**
