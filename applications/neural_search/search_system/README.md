 **目录**

* [介绍](#背景介绍)
* [检索系统](#检索系统)
    * [1. 召回](#召回服务)
    * [2. 排序](#排序服务)
    * [3. 系统运行](#系统运行)


<a name="背景介绍"></a>

# 介绍

使用召回模型和排序模型搭建一个完整的搜索流程


# 检索系统

<a name="召回服务"></a>

## 1. 召回

- 召回向量抽取服务的搭建请参考：[In-batch Negatives](../recall/in_batch_negative/)， 需要启动Pipeline Server服务

- 召回向量检索服务的搭建请参考：[Milvus](../recall/milvus/)， 需要搭建Milvus并且插入检索数据的向量

<a name="排序服务"></a>

## 2. 排序

排序服务的搭建请参考 [ernie_matching](../ranking/ernie_matching/)，同样的需要启动 Pipeline Serving服务


<a name="系统运行"></a>

## 3. 系统运行

```
python3 run_system.py
```
输出的结果为：

```
PipelineClient::predict pack_data time:1656991375.5521955
PipelineClient::predict before time:1656991375.5529568
Extract feature time to cost :0.0161135196685791 seconds
Search milvus time cost is 0.8139839172363281 seconds
PipelineClient::predict pack_data time:1656991376.3981335
PipelineClient::predict before time:1656991376.3983877
time to cost :0.05616641044616699 seconds
```
会输出2个文件 `recall_result.csv` 是召回检索的结果，`rank_result.csv` 是排序的结果。csv的示例输出下。

召回的结果：

```
中西方语言与文化的差异,港台文化对内地中小学生的负面影响,0.055068351328372955
中西方语言与文化的差异,外来文化在越南的传播与融合,0.05621318891644478
中西方语言与文化的差异,临终关怀中的“仪式”,0.05705389380455017
中西方语言与文化的差异,历史的真实与艺术加工,0.05745899677276611
......
```

排序的结果：

```
中西方语言与文化的差异,论中西方教育差异,0.870943009853363
中西方语言与文化的差异,浅析中西方问候语的差异,0.8468159437179565
中西方语言与文化的差异,文化认同及其根源,0.8288694620132446
中西方语言与文化的差异,从历史文化角度分析中西方学校教育的差异,0.8209370970726013
中西方语言与文化的差异,中西医思维方式的差异,0.8150948882102966
中西方语言与文化的差异,浅析中韩餐桌文化差异,0.7751647233963013
......
```
