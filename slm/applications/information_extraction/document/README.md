ç®€ä½“ä¸­æ–‡ | [English](README_en.md)

# æ–‡æ¡£ä¿¡æ¯æŠ½å–

**ç›®å½•**
- [1. æ–‡æ¡£ä¿¡æ¯æŠ½å–åº”ç”¨](#1)
- [2. å¿«é€Ÿå¼€å§‹](#2)
  - [2.1 ä»£ç ç»“æ„](#ä»£ç ç»“æ„)
  - [2.2 æ•°æ®æ ‡æ³¨](#æ•°æ®æ ‡æ³¨)
  - [2.3 æ¨¡å‹å¾®è°ƒ](#æ¨¡å‹å¾®è°ƒ)
  - [2.4 æ¨¡å‹è¯„ä¼°](#æ¨¡å‹è¯„ä¼°)
  - [2.5 å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹](#å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹)
  - [2.6 å®éªŒæŒ‡æ ‡](#å®éªŒæŒ‡æ ‡)

<a name="1"></a>

## 1. æ–‡æ¡£ä¿¡æ¯æŠ½å–åº”ç”¨

æœ¬é¡¹ç›®æä¾›åŸºäº UIE å¾®è°ƒçš„æ–‡æ¡£æŠ½å–ç«¯åˆ°ç«¯åº”ç”¨æ–¹æ¡ˆï¼Œæ‰“é€š**æ•°æ®æ ‡æ³¨-æ¨¡å‹è®­ç»ƒ-æ¨¡å‹è°ƒä¼˜-é¢„æµ‹éƒ¨ç½²å…¨æµç¨‹**ï¼Œå¯å¿«é€Ÿå®ç°æ–‡æ¡£ä¿¡æ¯æŠ½å–äº§å“è½åœ°ã€‚

ä¿¡æ¯æŠ½å–é€šä¿—åœ°è¯´å°±æ˜¯ä»ç»™å®šçš„æ–‡æœ¬/å›¾ç‰‡ç­‰è¾“å…¥æ•°æ®ä¸­æŠ½å–å‡ºç»“æ„åŒ–ä¿¡æ¯çš„è¿‡ç¨‹ã€‚åœ¨ä¿¡æ¯æŠ½å–çš„è½åœ°è¿‡ç¨‹ä¸­é€šå¸¸é¢ä¸´é¢†åŸŸå¤šå˜ã€ä»»åŠ¡å¤šæ ·ã€æ•°æ®ç¨€ç¼ºç­‰è®¸å¤šæŒ‘æˆ˜ã€‚é’ˆå¯¹ä¿¡æ¯æŠ½å–é¢†åŸŸçš„éš¾ç‚¹å’Œç—›ç‚¹ï¼ŒPaddleNLP ä¿¡æ¯æŠ½å–åº”ç”¨ UIE ç»Ÿä¸€å»ºæ¨¡çš„æ€æƒ³ï¼Œæä¾›äº†æ–‡æ¡£ä¿¡æ¯æŠ½å–äº§ä¸šçº§åº”ç”¨æ–¹æ¡ˆï¼Œæ”¯æŒ**æ–‡æ¡£/å›¾ç‰‡/è¡¨æ ¼å’Œçº¯æ–‡æœ¬åœºæ™¯ä¸‹å®ä½“ã€å…³ç³»ã€äº‹ä»¶ã€è§‚ç‚¹ç­‰ä¸åŒä»»åŠ¡ä¿¡æ¯æŠ½å–**ã€‚è¯¥åº”ç”¨**ä¸é™å®šè¡Œä¸šé¢†åŸŸå’ŒæŠ½å–ç›®æ ‡**ï¼Œå¯å®ç°ä»äº§å“åŸå‹ç ”å‘ã€ä¸šåŠ¡ POC é˜¶æ®µåˆ°ä¸šåŠ¡è½åœ°ã€è¿­ä»£é˜¶æ®µçš„æ— ç¼è¡”æ¥ï¼ŒåŠ©åŠ›å¼€å‘è€…å®ç°ç‰¹å®šé¢†åŸŸæŠ½å–åœºæ™¯çš„å¿«é€Ÿé€‚é…ä¸è½åœ°ã€‚

**æ–‡æ¡£ä¿¡æ¯æŠ½å–åº”ç”¨äº®ç‚¹ï¼š**

- **è¦†ç›–åœºæ™¯å…¨é¢ğŸ“ï¼š** è¦†ç›–æ–‡æ¡£ä¿¡æ¯æŠ½å–å„ç±»ä¸»æµä»»åŠ¡ï¼Œæ”¯æŒå¤šè¯­è¨€ï¼Œæ»¡è¶³å¼€å‘è€…å¤šæ ·ä¿¡æ¯æŠ½å–è½åœ°éœ€æ±‚ã€‚
- **æ•ˆæœé¢†å…ˆğŸƒï¼š** ä»¥åœ¨å¤šæ¨¡æ€ä¿¡æ¯æŠ½å–ä¸Šæœ‰çªå‡ºæ•ˆæœçš„æ¨¡å‹ UIE-X ä½œä¸ºè®­ç»ƒåŸºåº§ï¼Œå…·æœ‰å¹¿æ³›æˆç†Ÿçš„å®è·µåº”ç”¨æ€§ã€‚
- **ç®€å•æ˜“ç”¨âš¡ï¼š** é€šè¿‡ Taskflow å®ç°ä¸‰è¡Œä»£ç å¯å®ç°æ— æ ‡æ³¨æ•°æ®çš„æƒ…å†µä¸‹è¿›è¡Œå¿«é€Ÿè°ƒç”¨ï¼Œä¸€è¡Œå‘½ä»¤å³å¯å¼€å¯ä¿¡æ¯æŠ½å–è®­ç»ƒï¼Œè½»æ¾å®Œæˆéƒ¨ç½²ä¸Šçº¿ï¼Œé™ä½ä¿¡æ¯æŠ½å–æŠ€æœ¯è½åœ°é—¨æ§›ã€‚
- **é«˜æ•ˆè°ƒä¼˜âœŠï¼š** å¼€å‘è€…æ— éœ€æœºå™¨å­¦ä¹ èƒŒæ™¯çŸ¥è¯†ï¼Œå³å¯è½»æ¾ä¸Šæ‰‹æ•°æ®æ ‡æ³¨åŠæ¨¡å‹è®­ç»ƒæµç¨‹ã€‚

<a name="2"></a>

## 2. å¿«é€Ÿå¼€å§‹

å¯¹äºç®€å•çš„æŠ½å–ç›®æ ‡å¯ä»¥ç›´æ¥ä½¿ç”¨ ```paddlenlp.Taskflow```å®ç°é›¶æ ·æœ¬ï¼ˆzero-shotï¼‰æŠ½å–ï¼Œå¯¹äºç»†åˆ†åœºæ™¯æˆ‘ä»¬æ¨èä½¿ç”¨å®šåˆ¶åŠŸèƒ½ï¼ˆæ ‡æ³¨å°‘é‡æ•°æ®è¿›è¡Œæ¨¡å‹å¾®è°ƒï¼‰ä»¥è¿›ä¸€æ­¥æå‡æ•ˆæœã€‚

<a name="ä»£ç ç»“æ„"></a>

### 2.1 ä»£ç ç»“æ„

```shell
.
â”œâ”€â”€ deploy            # éƒ¨ç½²ç›®å½•
â”‚ â””â”€â”€ simple_serving  # åŸºäºPaddleNLP SimpleServing æœåŠ¡åŒ–éƒ¨ç½²
â”œâ”€â”€ utils.py          # æ•°æ®å¤„ç†å·¥å…·
â”œâ”€â”€ finetune.py       # æ¨¡å‹å¾®è°ƒã€å‹ç¼©è„šæœ¬
â”œâ”€â”€ evaluate.py       # æ¨¡å‹è¯„ä¼°è„šæœ¬
â””â”€â”€ README.md
```

<a name="æ•°æ®æ ‡æ³¨"></a>

### 2.2 æ•°æ®æ ‡æ³¨
æˆ‘ä»¬æ¨èä½¿ç”¨ [Label Studio](https://labelstud.io/) è¿›è¡Œæ–‡æ¡£ä¿¡æ¯æŠ½å–æ•°æ®æ ‡æ³¨ï¼Œæœ¬é¡¹ç›®æ‰“é€šäº†ä»æ•°æ®æ ‡æ³¨åˆ°è®­ç»ƒçš„é€šé“ï¼Œä¹Ÿå³ Label Studio å¯¼å‡ºæ•°æ®å¯ä»¥é€šè¿‡ [label_studio.py](../label_studio.py) è„šæœ¬è½»æ¾å°†æ•°æ®è½¬æ¢ä¸ºè¾“å…¥æ¨¡å‹æ—¶éœ€è¦çš„å½¢å¼ï¼Œå®ç°æ— ç¼è¡”æ¥ã€‚æ ‡æ³¨æ–¹æ³•çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ [Label Studio æ•°æ®æ ‡æ³¨æŒ‡å—](../label_studio_doc.md)ã€‚

è¿™é‡Œæˆ‘ä»¬æä¾›é¢„å…ˆæ ‡æ³¨å¥½çš„`å¢å€¼ç¨å‘ç¥¨æ•°æ®é›†`çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤è¡Œä¸‹è½½æ•°æ®é›†ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨æ•°æ®è½¬åŒ–è„šæœ¬ç”Ÿæˆè®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ UIE-X æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚

ä¸‹è½½å¢å€¼ç¨å‘ç¥¨æ•°æ®é›†ï¼š
```shell
wget https://paddlenlp.bj.bcebos.com/datasets/tax.tar.gz
tar -zxvf tax.tar.gz
mv tax data
rm tax.tar.gz
```

ç”Ÿæˆè®­ç»ƒ/éªŒè¯é›†æ–‡ä»¶ï¼š
```shell
python ../label_studio.py \
    --label_studio_file ./data/label_studio.json \
    --save_dir ./data \
    --splits 0.8 0.2 0 \
    --task_type ext
```

ç”Ÿæˆè®­ç»ƒ/éªŒè¯é›†æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ PP-Structure çš„å¸ƒå±€åˆ†æä¼˜åŒ– OCR ç»“æœçš„æ’åºï¼š
```shell
python ../label_studio.py \
    --label_studio_file ./data/label_studio.json \
    --save_dir ./data \
    --splits 0.8 0.2 0\
    --task_type ext \
    --layout_analysis True
```

æ›´å¤šä¸åŒç±»å‹ä»»åŠ¡ï¼ˆå«å®ä½“æŠ½å–ã€å…³ç³»æŠ½å–ã€æ–‡æ¡£åˆ†ç±»ç­‰ï¼‰çš„æ ‡æ³¨è§„åˆ™åŠå‚æ•°è¯´æ˜ï¼Œè¯·å‚è€ƒ[Label Studio æ•°æ®æ ‡æ³¨æŒ‡å—](../label_studio_doc.md)ã€‚

<a name="æ¨¡å‹å¾®è°ƒ"></a>

### 2.3 æ¨¡å‹å¾®è°ƒ

æ¨èä½¿ç”¨ [Trainer API ](https://github.com/PaddlePaddle/PaddleNLP/blob/develop/docs/trainer.md) å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚åªéœ€è¾“å…¥æ¨¡å‹ã€æ•°æ®é›†ç­‰å°±å¯ä»¥ä½¿ç”¨ Trainer API é«˜æ•ˆå¿«é€Ÿåœ°è¿›è¡Œé¢„è®­ç»ƒã€å¾®è°ƒå’Œæ¨¡å‹å‹ç¼©ç­‰ä»»åŠ¡ï¼Œå¯ä»¥ä¸€é”®å¯åŠ¨å¤šå¡è®­ç»ƒã€æ··åˆç²¾åº¦è®­ç»ƒã€æ¢¯åº¦ç´¯ç§¯ã€æ–­ç‚¹é‡å¯ã€æ—¥å¿—æ˜¾ç¤ºç­‰åŠŸèƒ½ï¼ŒTrainer API è¿˜é’ˆå¯¹è®­ç»ƒè¿‡ç¨‹çš„é€šç”¨è®­ç»ƒé…ç½®åšäº†å°è£…ï¼Œæ¯”å¦‚ï¼šä¼˜åŒ–å™¨ã€å­¦ä¹ ç‡è°ƒåº¦ç­‰ã€‚

ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œä½¿ç”¨ `uie-x-base` ä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œæ¨¡å‹å¾®è°ƒï¼Œå°†å¾®è°ƒåçš„æ¨¡å‹ä¿å­˜è‡³`./checkpoint/model_best`ï¼š

å•å¡å¯åŠ¨ï¼š

```shell
python finetune.py  \
    --device gpu \
    --logging_steps 5 \
    --save_steps 25 \
    --eval_steps 25 \
    --seed 42 \
    --model_name_or_path uie-x-base \
    --output_dir ./checkpoint/model_best \
    --train_path data/train.txt \
    --dev_path data/dev.txt  \
    --max_seq_len 512  \
    --per_device_train_batch_size  8 \
    --per_device_eval_batch_size 8 \
    --num_train_epochs 10 \
    --learning_rate 1e-5 \
    --do_train \
    --do_eval \
    --do_export \
    --export_model_dir ./checkpoint/model_best \
    --overwrite_output_dir \
    --disable_tqdm True \
    --metric_for_best_model eval_f1 \
    --load_best_model_at_end  True \
    --save_total_limit 1
```

å¦‚æœåœ¨ GPU ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥æŒ‡å®š gpus å‚æ•°è¿›è¡Œå¤šå¡è®­ç»ƒï¼š

```shell
python -u -m paddle.distributed.launch --gpus "0" finetune.py \
    --device gpu \
    --logging_steps 5 \
    --save_steps 25 \
    --eval_steps 25 \
    --seed 42 \
    --model_name_or_path uie-x-base \
    --output_dir ./checkpoint/model_best \
    --train_path data/train.txt \
    --dev_path data/dev.txt  \
    --max_seq_len 512  \
    --per_device_train_batch_size  8 \
    --per_device_eval_batch_size 8 \
    --num_train_epochs 10 \
    --learning_rate 1e-5 \
    --do_train \
    --do_eval \
    --do_export \
    --export_model_dir ./checkpoint/model_best \
    --overwrite_output_dir \
    --disable_tqdm True \
    --metric_for_best_model eval_f1 \
    --load_best_model_at_end  True \
    --save_total_limit 1
```

è¯¥ç¤ºä¾‹ä»£ç ä¸­ç”±äºè®¾ç½®äº†å‚æ•° `--do_eval`ï¼Œå› æ­¤åœ¨è®­ç»ƒå®Œä¼šè‡ªåŠ¨è¿›è¡Œè¯„ä¼°ã€‚

å¯é…ç½®å‚æ•°è¯´æ˜ï¼š
* `device`: è®­ç»ƒè®¾å¤‡ï¼Œå¯é€‰æ‹© 'cpu'ã€'gpu'ã€'npu' å…¶ä¸­çš„ä¸€ç§ï¼›é»˜è®¤ä¸º GPU è®­ç»ƒã€‚
* `logging_steps`: è®­ç»ƒè¿‡ç¨‹ä¸­æ—¥å¿—æ‰“å°çš„é—´éš” steps æ•°ï¼Œé»˜è®¤10ã€‚
* `save_steps`: è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜æ¨¡å‹ checkpoint çš„é—´éš” steps æ•°ï¼Œé»˜è®¤100ã€‚
* `eval_steps`: è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜æ¨¡å‹ checkpoint çš„é—´éš” steps æ•°ï¼Œé»˜è®¤100ã€‚
* `seed`ï¼šå…¨å±€éšæœºç§å­ï¼Œé»˜è®¤ä¸º 42ã€‚
* `model_name_or_path`ï¼šè¿›è¡Œ few shot è®­ç»ƒä½¿ç”¨çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚é»˜è®¤ä¸º "uie-x-base"ã€‚
* `output_dir`ï¼šå¿…é¡»ï¼Œæ¨¡å‹è®­ç»ƒæˆ–å‹ç¼©åä¿å­˜çš„æ¨¡å‹ç›®å½•ï¼›é»˜è®¤ä¸º `None` ã€‚
* `train_path`ï¼šè®­ç»ƒé›†è·¯å¾„ï¼›é»˜è®¤ä¸º `None` ã€‚
* `dev_path`ï¼šå¼€å‘é›†è·¯å¾„ï¼›é»˜è®¤ä¸º `None` ã€‚
* `max_seq_len`ï¼šæ–‡æœ¬æœ€å¤§åˆ‡åˆ†é•¿åº¦ï¼Œè¾“å…¥è¶…è¿‡æœ€å¤§é•¿åº¦æ—¶ä¼šå¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œè‡ªåŠ¨åˆ‡åˆ†ï¼Œé»˜è®¤ä¸º512ã€‚
* `per_device_train_batch_size`:ç”¨äºè®­ç»ƒçš„æ¯ä¸ª GPU æ ¸å¿ƒ/NPU æ ¸å¿ƒ/CPU çš„ batch å¤§å°ï¼Œé»˜è®¤ä¸º8ã€‚
* `per_device_eval_batch_size`:ç”¨äºè¯„ä¼°çš„æ¯ä¸ª GPU æ ¸å¿ƒ/NPU æ ¸å¿ƒ/CPU çš„ batch å¤§å°ï¼Œé»˜è®¤ä¸º8ã€‚
* `num_train_epochs`: è®­ç»ƒè½®æ¬¡ï¼Œä½¿ç”¨æ—©åœæ³•æ—¶å¯ä»¥é€‰æ‹© 100ï¼›é»˜è®¤ä¸º10ã€‚
* `learning_rate`ï¼šè®­ç»ƒæœ€å¤§å­¦ä¹ ç‡ï¼ŒUIE-X æ¨èè®¾ç½®ä¸º 1e-5ï¼›é»˜è®¤å€¼ä¸º3e-5ã€‚
* `label_names`ï¼šè®­ç»ƒæ•°æ®æ ‡ç­¾ label çš„åç§°ï¼ŒUIE-X è®¾ç½®ä¸º'start_positions' 'end_positions'ï¼›é»˜è®¤å€¼ä¸º Noneã€‚
* `do_train`:æ˜¯å¦è¿›è¡Œå¾®è°ƒè®­ç»ƒï¼Œè®¾ç½®è¯¥å‚æ•°è¡¨ç¤ºè¿›è¡Œå¾®è°ƒè®­ç»ƒï¼Œé»˜è®¤ä¸è®¾ç½®ã€‚
* `do_eval`:æ˜¯å¦è¿›è¡Œè¯„ä¼°ï¼Œè®¾ç½®è¯¥å‚æ•°è¡¨ç¤ºè¿›è¡Œè¯„ä¼°ï¼Œé»˜è®¤ä¸è®¾ç½®ã€‚
* `do_export`:æ˜¯å¦è¿›è¡Œå¯¼å‡ºï¼Œè®¾ç½®è¯¥å‚æ•°è¡¨ç¤ºè¿›è¡Œé™æ€å›¾å¯¼å‡ºï¼Œé»˜è®¤ä¸è®¾ç½®ã€‚
* `export_model_dir`:é™æ€å›¾å¯¼å‡ºåœ°å€ï¼Œé»˜è®¤ä¸º Noneã€‚
* `overwrite_output_dir`ï¼š å¦‚æœ `True`ï¼Œè¦†ç›–è¾“å‡ºç›®å½•çš„å†…å®¹ã€‚å¦‚æœ `output_dir` æŒ‡å‘æ£€æŸ¥ç‚¹ç›®å½•ï¼Œåˆ™ä½¿ç”¨å®ƒç»§ç»­è®­ç»ƒã€‚
* `disable_tqdm`ï¼š æ˜¯å¦ä½¿ç”¨ tqdm è¿›åº¦æ¡ã€‚
* `metric_for_best_model`ï¼šæœ€ä¼˜æ¨¡å‹æŒ‡æ ‡,UIE-X æ¨èè®¾ç½®ä¸º `eval_f1`ï¼Œé»˜è®¤ä¸º Noneã€‚
* `load_best_model_at_end`ï¼šè®­ç»ƒç»“æŸåæ˜¯å¦åŠ è½½æœ€ä¼˜æ¨¡å‹ï¼Œé€šå¸¸ä¸`metric_for_best_model`é…åˆä½¿ç”¨ï¼Œé»˜è®¤ä¸º Falseã€‚
* `save_total_limit`ï¼šå¦‚æœè®¾ç½®æ¬¡å‚æ•°ï¼Œå°†é™åˆ¶ checkpoint çš„æ€»æ•°ã€‚åˆ é™¤æ—§çš„ checkpoints `è¾“å‡ºç›®å½•`ï¼Œé»˜è®¤ä¸º Noneã€‚

<a name="æ¨¡å‹è¯„ä¼°"></a>

### 2.4 æ¨¡å‹è¯„ä¼°

```shell
python evaluate.py \
    --device "gpu" \
    --model_path ./checkpoint/model_best \
    --test_path ./data/dev.txt \
    --output_dir ./checkpoint/model_best \
    --label_names 'start_positions' 'end_positions'\
    --max_seq_len 512 \
    --per_device_eval_batch_size 16
```
è¯„ä¼°æ–¹å¼è¯´æ˜ï¼šé‡‡ç”¨å•é˜¶æ®µè¯„ä»·çš„æ–¹å¼ï¼Œå³å…³ç³»æŠ½å–ã€äº‹ä»¶æŠ½å–ç­‰éœ€è¦åˆ†é˜¶æ®µé¢„æµ‹çš„ä»»åŠ¡å¯¹æ¯ä¸€é˜¶æ®µçš„é¢„æµ‹ç»“æœè¿›è¡Œåˆ†åˆ«è¯„ä»·ã€‚éªŒè¯/æµ‹è¯•é›†é»˜è®¤ä¼šåˆ©ç”¨åŒä¸€å±‚çº§çš„æ‰€æœ‰æ ‡ç­¾æ¥æ„é€ å‡ºå…¨éƒ¨è´Ÿä¾‹ã€‚

å¯å¼€å¯`debug`æ¨¡å¼å¯¹æ¯ä¸ªæ­£ä¾‹ç±»åˆ«åˆ†åˆ«è¿›è¡Œè¯„ä¼°ï¼Œè¯¥æ¨¡å¼ä»…ç”¨äºæ¨¡å‹è°ƒè¯•ï¼š

```shell
python evaluate.py \
    --device "gpu" \
    --model_path ./checkpoint/model_best \
    --test_path ./data/dev.txt \
    --output_dir ./checkpoint/model_best \
    --label_names 'start_positions' 'end_positions'\
    --max_seq_len 512 \
    --per_device_eval_batch_size 16 \
    --debug True
```

è¾“å‡ºç»“æœï¼š
```text
[2022-11-14 09:41:18,424] [    INFO] - ***** Running Evaluation *****
[2022-11-14 09:41:18,424] [    INFO] -   Num examples = 160
[2022-11-14 09:41:18,424] [    INFO] -   Pre device batch size = 4
[2022-11-14 09:41:18,424] [    INFO] -   Total Batch size = 4
[2022-11-14 09:41:18,424] [    INFO] -   Total prediction steps = 40
[2022-11-14 09:41:26,451] [    INFO] - -----Evaluate model-------
[2022-11-14 09:41:26,451] [    INFO] - Class Name: ALL CLASSES
[2022-11-14 09:41:26,451] [    INFO] - Evaluation Precision: 0.94521 | Recall: 0.88462 | F1: 0.91391
[2022-11-14 09:41:26,451] [    INFO] - -----------------------------
[2022-11-14 09:41:26,452] [    INFO] - ***** Running Evaluation *****
[2022-11-14 09:41:26,452] [    INFO] -   Num examples = 8
[2022-11-14 09:41:26,452] [    INFO] -   Pre device batch size = 4
[2022-11-14 09:41:26,452] [    INFO] -   Total Batch size = 4
[2022-11-14 09:41:26,452] [    INFO] -   Total prediction steps = 2
[2022-11-14 09:41:26,692] [    INFO] - Class Name: å¼€ç¥¨æ—¥æœŸ
[2022-11-14 09:41:26,692] [    INFO] - Evaluation Precision: 1.00000 | Recall: 1.00000 | F1: 1.00000
[2022-11-14 09:41:26,692] [    INFO] - -----------------------------
[2022-11-14 09:41:26,693] [    INFO] - ***** Running Evaluation *****
[2022-11-14 09:41:26,693] [    INFO] -   Num examples = 8
[2022-11-14 09:41:26,693] [    INFO] -   Pre device batch size = 4
[2022-11-14 09:41:26,693] [    INFO] -   Total Batch size = 4
[2022-11-14 09:41:26,693] [    INFO] -   Total prediction steps = 2
[2022-11-14 09:41:26,952] [    INFO] - Class Name: åç§°
[2022-11-14 09:41:26,952] [    INFO] - Evaluation Precision: 0.87500 | Recall: 0.87500 | F1: 0.87500
[2022-11-14 09:41:26,952] [    INFO] - -----------------------------
...
```

å¯é…ç½®å‚æ•°ï¼š
* `device`: è¯„ä¼°è®¾å¤‡ï¼Œå¯é€‰æ‹© 'cpu'ã€'gpu'ã€'npu' å…¶ä¸­çš„ä¸€ç§ï¼›é»˜è®¤ä¸º GPU è¯„ä¼°ã€‚
* `model_path`: è¿›è¡Œè¯„ä¼°çš„æ¨¡å‹æ–‡ä»¶å¤¹è·¯å¾„ï¼Œè·¯å¾„ä¸‹éœ€åŒ…å«æ¨¡å‹æƒé‡æ–‡ä»¶`model_state.pdparams`åŠé…ç½®æ–‡ä»¶`model_config.json`ã€‚
* `test_path`: è¿›è¡Œè¯„ä¼°çš„æµ‹è¯•é›†æ–‡ä»¶ã€‚
* `label_names`ï¼šè®­ç»ƒæ•°æ®æ ‡ç­¾ label çš„åç§°ï¼ŒUIE-X è®¾ç½®ä¸º'start_positions' 'end_positions'ï¼›é»˜è®¤å€¼ä¸º Noneã€‚
* `batch_size`: æ‰¹å¤„ç†å¤§å°ï¼Œè¯·ç»“åˆæœºå™¨æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œé»˜è®¤ä¸º16ã€‚
* `max_seq_len`: æ–‡æœ¬æœ€å¤§åˆ‡åˆ†é•¿åº¦ï¼Œè¾“å…¥è¶…è¿‡æœ€å¤§é•¿åº¦æ—¶ä¼šå¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œè‡ªåŠ¨åˆ‡åˆ†ï¼Œé»˜è®¤ä¸º512ã€‚
* `per_device_eval_batch_size`:ç”¨äºè¯„ä¼°çš„æ¯ä¸ª GPU æ ¸å¿ƒ/NPU æ ¸å¿ƒ/CPU çš„ batch å¤§å°ï¼Œé»˜è®¤ä¸º8ã€‚
* `debug`: æ˜¯å¦å¼€å¯ debug æ¨¡å¼å¯¹æ¯ä¸ªæ­£ä¾‹ç±»åˆ«åˆ†åˆ«è¿›è¡Œè¯„ä¼°ï¼Œè¯¥æ¨¡å¼ä»…ç”¨äºæ¨¡å‹è°ƒè¯•ï¼Œé»˜è®¤å…³é—­ã€‚
* `schema_lang`: é€‰æ‹© schema çš„è¯­è¨€ï¼Œå¯é€‰æœ‰`ch`å’Œ`en`ã€‚é»˜è®¤ä¸º`ch`ï¼Œè‹±æ–‡æ•°æ®é›†è¯·é€‰æ‹©`en`ã€‚

<a name="å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹"></a>

### 2.5 å®šåˆ¶æ¨¡å‹ä¸€é”®é¢„æµ‹

`paddlenlp.Taskflow`è£…è½½å®šåˆ¶æ¨¡å‹ï¼Œé€šè¿‡`task_path`æŒ‡å®šæ¨¡å‹æƒé‡æ–‡ä»¶çš„è·¯å¾„ï¼Œè·¯å¾„ä¸‹éœ€è¦åŒ…å«è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡æ–‡ä»¶`model_state.pdparams`ã€‚

```python
from pprint import pprint
from paddlenlp import Taskflow
from paddlenlp.utils.doc_parser import DocParser

schema = ['å¼€ç¥¨æ—¥æœŸ', 'åç§°', 'çº³ç¨äººè¯†åˆ«å·', 'å¼€æˆ·è¡ŒåŠè´¦å·', 'é‡‘é¢', 'ä»·ç¨åˆè®¡', 'No', 'ç¨ç‡', 'åœ°å€ã€ç”µè¯', 'ç¨é¢']
my_ie = Taskflow("information_extraction", model="uie-x-base", schema=schema, task_path='./checkpoint/model_best', precision='fp16')
```

æˆ‘ä»¬å¯ä»¥æ ¹æ®è®¾ç½®çš„`schema`ï¼Œå¯¹æŒ‡å®šçš„`doc_path`æ–‡æ¡£è¿›è¡Œä¿¡æ¯æŠ½å–å¹¶è¿›è¡Œå¯è§†åŒ–ï¼š

```python
doc_path = "./data/images/b199.jpg"
results = my_ie({"doc": doc_path})
pprint(results)

# ç»“æœå¯è§†åŒ–
DocParser.write_image_with_results(
    doc_path,
    result=results[0],
    save_path="./image_show.png")
```

<div align="center">
    <img src=https://user-images.githubusercontent.com/40840292/206084942-44ba477c-9244-4ce2-bbb5-ba430c9b926e.png height=550 width=700 />
</div>

<a name="å®éªŒæŒ‡æ ‡"></a>

### 2.6 å®éªŒæŒ‡æ ‡

æˆ‘ä»¬åœ¨è‡ªæ ‡æ³¨çš„å¢å€¼ç¨æ•°æ®é›†ä¸Šè¿›è¡Œå®éªŒï¼š


  |  |  Precision  | Recall | F1 Score |
  | :---: | :--------: | :--------: | :--------: |
  | 0-shot| 0.44898 | 0.56410  | 0.50000 |
  | 5-shot| 0.9000 | 0.9231 | 0.9114 |
  | 10-shot| 0.9125 | 0.93590 |  0.9241 |
  | 20-shot| 0.9737 | 0.9487 | 0.9610 |
  | 30-shot|  0.9744  | 0.9744  | 0.9744 |
  | 30-shot+PP-Structure| 1.0  | 0.9625 |  0.9809 |


n-shot è¡¨ç¤ºè®­ç»ƒé›†åŒ…å« n å¼ æ ‡æ³¨å›¾ç‰‡æ•°æ®è¿›è¡Œæ¨¡å‹å¾®è°ƒï¼Œå®éªŒè¡¨æ˜ UIE-X å¯ä»¥é€šè¿‡å°‘é‡æ•°æ®ï¼ˆfew-shotï¼‰å’Œ PP-Structure çš„å¸ƒå±€åˆ†æè¿›ä¸€æ­¥æå‡ç»“æœã€‚
