#!/usr/bin/env python
# -*- coding:utf-8 -*-
import json

label_mapper = {
    "会见": "交往-会见",
    "感谢": "交往-感谢",
    "探班": "交往-探班",
    "点赞": "交往-点赞",
    "道歉": "交往-道歉",
    "上映": "产品行为-上映",
    "下架": "产品行为-下架",
    "发布": "产品行为-发布",
    "召回": "产品行为-召回",
    "获奖": "产品行为-获奖",
    "产子/女": "人生-产子/女",
    "出轨": "人生-出轨",
    "分手": "人生-分手",
    "失联": "人生-失联",
    "婚礼": "人生-婚礼",
    "庆生": "人生-庆生",
    "怀孕": "人生-怀孕",
    "死亡": "人生-死亡",
    "求婚": "人生-求婚",
    "离婚": "人生-离婚",
    "结婚": "人生-结婚",
    "订婚": "人生-订婚",
    "举报": "司法行为-举报",
    "入狱": "司法行为-入狱",
    "开庭": "司法行为-开庭",
    "拘捕": "司法行为-拘捕",
    "立案": "司法行为-立案",
    "约谈": "司法行为-约谈",
    "罚款": "司法行为-罚款",
    "起诉": "司法行为-起诉",
    "地震": "灾害/意外-地震",
    "坍/垮塌": "灾害/意外-坍/垮塌",
    "坠机": "灾害/意外-坠机",
    "洪灾": "灾害/意外-洪灾",
    "爆炸": "灾害/意外-爆炸",
    "袭击": "灾害/意外-袭击",
    "起火": "灾害/意外-起火",
    "车祸": "灾害/意外-车祸",
    "夺冠": "竞赛行为-夺冠",
    "晋级": "竞赛行为-晋级",
    "禁赛": "竞赛行为-禁赛",
    "胜负": "竞赛行为-胜负",
    "退役": "竞赛行为-退役",
    "退赛": "竞赛行为-退赛",
    "停职": "组织关系-停职",
    "加盟": "组织关系-加盟",
    "裁员": "组织关系-裁员",
    "解散": "组织关系-解散",
    "解约": "组织关系-解约",
    "解雇": "组织关系-解雇",
    "辞/离职": "组织关系-辞/离职",
    "退出": "组织关系-退出",
    "开幕": "组织行为-开幕",
    "游行": "组织行为-游行",
    "罢工": "组织行为-罢工",
    "闭幕": "组织行为-闭幕",
    "上市": "财经/交易-上市",
    "出售/收购": "财经/交易-出售/收购",
    "加息": "财经/交易-加息",
    "涨价": "财经/交易-涨价",
    "涨停": "财经/交易-涨停",
    "融资": "财经/交易-融资",
    "跌停": "财经/交易-跌停",
    "降价": "财经/交易-降价",
    "降息": "财经/交易-降息",
    "上市企业": "上市企业",
    "上映影视": "上映影视",
    "上映方": "上映方",
    "下架产品": "下架产品",
    "下架方": "下架方",
    "举报发起方": "举报发起方",
    "举报对象": "举报对象",
    "交易物": "交易物",
    "产子者": "产子者",
    "会见主体": "会见主体",
    "会见对象": "会见对象",
    "停职人员": "停职人员",
    "入狱者": "入狱者",
    "冠军": "冠军",
    "出售价格": "出售价格",
    "出售方": "出售方",
    "出生者": "出生者",
    "出轨对象": "出轨对象",
    "出轨方": "出轨方",
    "分手双方": "分手双方",
    "刑期": "刑期",
    "加息幅度": "加息幅度",
    "加息机构": "加息机构",
    "加盟者": "加盟者",
    "原告": "原告",
    "原所属组织": "原所属组织",
    "参礼人员": "参礼人员",
    "发布产品": "发布产品",
    "发布方": "发布方",
    "受伤人数": "受伤人数",
    "召回内容": "召回内容",
    "召回方": "召回方",
    "地点": "地点",
    "坍塌主体": "坍塌主体",
    "失联者": "失联者",
    "夺冠赛事": "夺冠赛事",
    "奖项": "奖项",
    "庆祝方": "庆祝方",
    "开庭案件": "开庭案件",
    "开庭法院": "开庭法院",
    "怀孕者": "怀孕者",
    "所加盟组织": "所加盟组织",
    "所属组织": "所属组织",
    "执法机构": "执法机构",
    "拘捕者": "拘捕者",
    "探班主体": "探班主体",
    "探班对象": "探班对象",
    "收购方": "收购方",
    "时间": "时间",
    "晋级方": "晋级方",
    "晋级赛事": "晋级赛事",
    "死亡人数": "死亡人数",
    "死者": "死者",
    "死者年龄": "死者年龄",
    "求婚对象": "求婚对象",
    "求婚者": "求婚者",
    "活动名称": "活动名称",
    "涨价幅度": "涨价幅度",
    "涨价方": "涨价方",
    "涨价物": "涨价物",
    "涨停股票": "涨停股票",
    "游行人数": "游行人数",
    "游行组织": "游行组织",
    "点赞对象": "点赞对象",
    "点赞方": "点赞方",
    "生日方": "生日方",
    "生日方年龄": "生日方年龄",
    "禁赛时长": "禁赛时长",
    "禁赛机构": "禁赛机构",
    "离婚双方": "离婚双方",
    "离职者": "离职者",
    "立案对象": "立案对象",
    "立案机构": "立案机构",
    "约谈发起方": "约谈发起方",
    "约谈对象": "约谈对象",
    "结婚双方": "结婚双方",
    "罚款对象": "罚款对象",
    "罚款金额": "罚款金额",
    "罢工人员": "罢工人员",
    "罢工人数": "罢工人数",
    "胜者": "胜者",
    "致谢人": "致谢人",
    "获奖人": "获奖人",
    "融资方": "融资方",
    "融资轮次": "融资轮次",
    "融资金额": "融资金额",
    "被下架方": "被下架方",
    "被告": "被告",
    "被感谢人": "被感谢人",
    "被拘捕者": "被拘捕者",
    "被禁赛人员": "被禁赛人员",
    "被解约方": "被解约方",
    "被解雇人员": "被解雇人员",
    "袭击对象": "袭击对象",
    "袭击者": "袭击者",
    "裁员人数": "裁员人数",
    "裁员方": "裁员方",
    "解散方": "解散方",
    "解约方": "解约方",
    "解雇方": "解雇方",
    "订婚主体": "订婚主体",
    "败者": "败者",
    "赛事名称": "赛事名称",
    "跌停股票": "跌停股票",
    "跟投方": "跟投方",
    "退出方": "退出方",
    "退役者": "退役者",
    "退赛方": "退赛方",
    "退赛赛事": "退赛赛事",
    "道歉对象": "道歉对象",
    "道歉者": "道歉者",
    "降价幅度": "降价幅度",
    "降价方": "降价方",
    "降价物": "降价物",
    "降息幅度": "降息幅度",
    "降息机构": "降息机构",
    "震中": "震中",
    "震源深度": "震源深度",
    "震级": "震级",
    "颁奖机构": "颁奖机构",
    "领投方": "领投方",
}


def convert(instance):
    #  "event_list":[                               // 抽取到的所有事件列表
    #     {
    #         "event_type":"竞赛行为-胜负",          // 事件类型
    #         "arguments":[                        // 该事件类型对应的论元
    #             {
    #                 "role":"时间",                // 论元角色
    #                 "argument":"北京时间9月9日上午" // 论元
    #             },
    #             ...
    #         ]
    #     },
    #     ...
    # ]
    submit_instance = {'event_list': list()}
    for event in instance['event']['string']:
        submit_instance['event_list'] += [{
            'event_type': label_mapper[event['type']],
            'arguments': [{
                'role': label_mapper[role],
                'argument': arg,
            } for role, arg in event['roles']]
        }]
    return submit_instance


def main():
    # pred_file = "/home/yaojie/code/release/uie/output/pd_models_t5-char-100g-small-30w-uie-zh-qb-50w_data_text2spotasoc_event_duee_b32_lr3e-4/valid-preds_record.txt"
    pred_file = "/data/yaojie/code/development/duee_evaluation/test-preds_record.txt"
    test_file = "/home/yaojie/code/development/universal_ie/data/chinese_ie_data/DuEE1.0/duee_test2.json/duee_test2.json"
    # test_file = "/home/yaojie/code/development/universal_ie/data/chinese_ie_data/DuEE1.0/duee_dev.json/duee_dev.json"
    output_file = "/data/yaojie/code/development/duee_evaluation/duee.pred.json"
    pred_instance = [json.loads(line.strip()) for line in open(pred_file)]
    test_instance = [json.loads(line.strip()) for line in open(test_file)]
    with open(output_file, 'w') as output:
        for pred, test in zip(pred_instance, test_instance):
            pred = convert(pred)
            pred['id'] = test['id']
            output.write(json.dumps(pred, ensure_ascii=False) + '\n')


if __name__ == "__main__":
    main()
